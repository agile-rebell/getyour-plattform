<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHS Qualifizierung</title>
  </head>
  <body style="margin: 0; background: #ebebeb; font-family: sans-serif; background-image: url('img/qualifizierung-bg.png'); background-repeat: no-repeat; background-size: cover;">

    <header></header>

    <div class="info"></div>

    <div class="funnel-placeholder"></div>

    <footer></footer>

    <script type="module">
      import { HeaderField } from "../../../../js/HeaderField.js"
      import { InfoField } from "../../../../js/InfoField.js"
      import { FunnelField } from "../../../../js/FunnelField.js"
      import { Helper } from "../../../../js/Helper.js"
      import { Request } from "../../../../js/Request.js"
      import { FooterField } from "../../../../js/FooterField.js"

      const headerField = new HeaderField()
      .withImage(img => {
        img.src = "/felix/shs/img/shslogo.png"
        img.alt = "SHS Express Logo"
        img.style.cursor = "pointer"
        img.style.width = "144px"
        img.addEventListener("click", async() => window.location.reload())
      })
      .withType(header => {
        header.style.position = "fixed"
        header.style.top = "0"
        header.style.left = "0"
      })

      const infoField = new InfoField("info")
      .withSuccess(/*html*/`
        <div style="font-size: 21px; margin-bottom: 55px"> Jetzt <span style="color: #f27f2a;">Unabhängig</span> von öffentlichen Energieversorgern werden!</div>
        <div style="margin-bottom: 21px">Erstellen Sie sich einfach ihr maßgeschneidertes Energiekonzept.</div>
        <div>Kostenlos & unverbindlich.</div>
      `)
      .withType(info => {
        info.style.margin = "144px 34px 34px 34px"
      })

      const getFunnel = {}
      getFunnel.url = "/consumer/v1/"
      getFunnel.consumer = "operator"
      getFunnel.method = "get"
      getFunnel.name = "shs"
      getFunnel.type = "funnel"
      getFunnel.security = "open"
      const res = await Request.middleware(getFunnel)

      if (res.status !== 200) {
        const confirm = window.confirm(`Es tut uns leid, aber es ist ein Fehler aufgetreten. Wenn dieser Fehler weiterhin auftritt, bitten wir Sie, uns zu kontaktieren.\n\nWir möchten sicherstellen, dass unsere Dienste reibungslos funktionieren und Ihr Feedback ist uns dabei sehr wichtig.\n\nMöchten Sie uns kontaktieren?`)
        if (confirm === true) window.location.href = "mailto:datenschutz@get-your.de"
        throw new Error("funnel request failed")
      }

      const funnel = JSON.parse(res.response)

      const storage = JSON.parse(window.localStorage.getItem(funnel.storage))
      if (storage !== null) {
        window.location.assign(funnel.path.house)
        throw new Error("funnel exist")
      }

      const funnelField = new FunnelField("funnel-placeholder")
      .withFunnel(funnel)
      .withUnloadEventListener()
      .withClickOnAnswerEventListener((questionIndex, answerIndex) => {

        if (questionIndex === 0 && answerIndex === 1) {
          const confirm = window.confirm("Möchten Sie stattdessen einen persönlichen Ansprechpartner kontaktieren?")
          if (confirm === true) return window.location.assign("/felix/shs/ansprechpartner/kontaktieren/")
          window.location.assign("/felix/shs/")
          return
        }

        if (questionIndex === 1 && answerIndex === 1) {
          window.location.assign("/felix/shs/")
          return
        }

        if (questionIndex === 1 && answerIndex === 3) {
          window.location.assign("/felix/shs/")
          return
        }

        if (questionIndex === 10 && answerIndex === 1) {
          const q7 = JSON.parse(window.localStorage.getItem(funnel.storage)).value.q7
          const q8 = JSON.parse(window.localStorage.getItem(funnel.storage)).value.q8
          const q9 = JSON.parse(window.localStorage.getItem(funnel.storage)).value.q9

          if (q7 === 1 && q8 === 1 && q9 === 1) {
            window.location.assign("/felix/shs/")
            return
          }
        }

        if (questionIndex === 11 && answerIndex === 1) {
          window.location.assign("/felix/shs/")
          return
        }

        funnel.questionIndex = funnel.questionIndex + 1
        funnelField.withFunnel(funnel)
      })
      .withFunnelCompleted(() => window.location.assign(funnel.path.house))

      const footerField = new FooterField()
      .withType(footer => {
        footer.style.textAlign = "center"
        footer.style.backgroundColor = "#60a182"
        footer.style.padding = "21px 34px"
        footer.style.marginTop = "144px"

        const impressum = document.createElement("div")
        impressum.innerHTML = "Impressum"
        impressum.style.cursor = "pointer"
        impressum.style.padding = "13px"
        impressum.addEventListener("click", () => window.location.assign("/felix/shs/impressum/"))
        footer.append(impressum)

        const dsgvo = document.createElement("div")
        dsgvo.innerHTML = "Datenschutz"
        dsgvo.style.cursor = "pointer"
        dsgvo.style.padding = "13px"
        dsgvo.addEventListener("click", () => window.location.assign("/felix/shs/datenschutz/"))
        footer.append(dsgvo)

        const userAgreement = document.createElement("div")
        userAgreement.innerHTML = "Nutzervereinbarung"
        userAgreement.style.cursor = "pointer"
        userAgreement.style.padding = "13px"
        userAgreement.addEventListener("click", () => window.location.assign("/nutzervereinbarung/"))
        footer.append(userAgreement)
      })

    </script>

  </body>
</html>
