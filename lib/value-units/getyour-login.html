<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="shortcut icon" href="/public/getyour-logo.svg" />
    <title>Getyour Plattform Login</title>

    <style>
      body {
        margin: 0;
        line-height: 1.2;
        font-family: sans-serif;
      }
    </style>

  </head>
  <body>

    <header></header>

    <h1 class="title"></h1>

    <div class="email"></div>

    <div class="login-button"></div>

    <div class="info"></div>

    <footer></footer>

  <script type="module">
    import { HeaderField } from "/js/HeaderField.js"
    import { Helper } from "/js/Helper.js"
    import { DivField } from "/js/DivField.js"
    import { EmailField } from "/js/EmailField.js"
    import { Request } from "/js/Request.js"
    import { InfoField } from "/js/InfoField.js"
    import { FooterField } from "/js/FooterField.js"

    const headerField = new HeaderField()
    .withType(header => {
      header.style.backgroundColor = "white"
      header.style.width = "100%"
      header.style.position = "fixed"
      header.style.top = "0"
      header.style.left = "0"
      header.style.zIndex = "1"

    })
    .withImage(img => {
      img.style.width = "89px"
      img.src = "/public/getyour-logo.svg"
      img.alt = "Getyour Plattform Logo"
      img.style.cursor = "pointer"
      img.addEventListener("click", () => window.history.back())
    })
    .build()

    document.querySelectorAll(".title").forEach(title => {
      title.innerHTML = "Login"
      title.style.margin = "144px 34px 34px 34px"
      title.style.fontWeight = "normal"
    })

    const emailField = new EmailField("email")
    .withLabel(label => label.innerHTML = "E-Mail Adresse")
    .withType((input) => {
      input.placeholder = "meine@email.de"
      input.required = true
    })
    .onInput(async() => {
      emailField.withStorage(value => {
        window.localStorage.setItem(emailField.name, value)
      })
    })
    .fromStorage((name) => window.localStorage.getItem(name))
    emailField.withStorage(value => {
      window.localStorage.setItem(emailField.name, value)
    })

    const loginbutton = new DivField("login-button")
    .withType(div => {
      div.innerHTML = "Login"
      div.style.backgroundColor = "#c02221"
      div.style.cursor = "pointer"
      div.style.fontSize = "21px"
      div.style.borderRadius = "13px"
      div.style.margin = "13px 34px"
      div.style.display = "flex"
      div.style.justifyContent = "center"
      div.style.alignItems = "center"
      div.style.height = "89px"
      div.addEventListener("mouseover", () => div.style.backgroundColor = "#f19d08")
      div.addEventListener("mouseout", () => div.style.backgroundColor = "#c02221")
    })
    .onClick(async (event) => {
      const email = await emailField.withValidValue()
      await Request.verifyEmail(email)



      const localStorageId = Request.localStorageId()

      const registerEmail = {}
      registerEmail.url = "/consumer/v1/"
      registerEmail.method = "register"
      registerEmail.type = "email"
      registerEmail.security = "open"
      registerEmail.localStorageId = localStorageId
      registerEmail.email = email
      await Request.sequence(registerEmail)

      const registerVerified = {}
      registerVerified.url = "/consumer/v1/"
      registerVerified.method = "register"
      registerVerified.type = "verified"
      registerVerified.security = "open"
      registerVerified.localStorageId = localStorageId
      await Request.sequence(registerVerified)

      const registerSession = {}
      registerSession.url = "/request/register/session/"
      registerSession.method = "register"
      registerSession.type = "session"
      registerSession.event = "onlogin"
      registerSession.security = "open"
      registerSession.localStorageId = localStorageId
      await Request.sequence(registerSession)

      await Helper.redirectUser("onlogin")
    })

    const infoField = new InfoField("info")
    .withSuccess(/*html*/`
      <div>Unser Login Prozess ist intuitiv gestaltet und erfordert nur wenige Klicks. Sie müssen lediglich Ihre E-Mail Adresse eingeben, um sich einzuloggen. Wir möchten, dass Sie den Login Prozess als einfach und stressfrei erleben. <a href="mailto:datenschutz@get-your.de">Wenn Sie Probleme haben oder Hilfe benötigen, stehen wir Ihnen jederzeit zur Verfügung, um Ihnen schnell und effektiv weiter zu helfen.</a></div>
      <div style="margin-top: 13px;">Die Plattform von getyour soll ein sicheres und vertrauenswürdiges Umfeld bieten, damit Sie sich auf Ihre Daten verlassen können.</div>
    `)
    .build()

    const footerField = new FooterField()
    .withType(footer => {
      footer.style.backgroundColor = "#781717"
      footer.style.padding = "21px 34px"
      footer.style.marginTop = "144px"
      footer.style.color = "#d1d1d1"

      const impressum = document.createElement("div")
      impressum.innerHTML = "IMPRESSUM"
      impressum.style.cursor = "pointer"
      impressum.style.padding = "13px"
      impressum.addEventListener("click", () => window.location.assign("/impressum/"))
      footer.append(impressum)

      const dsgvo = document.createElement("div")
      dsgvo.innerHTML = "DATENSCHUTZ"
      dsgvo.style.cursor = "pointer"
      dsgvo.style.padding = "13px"
      dsgvo.addEventListener("click", () => window.location.assign("/datenschutz/"))
      footer.append(dsgvo)

      const userAgreement = document.createElement("div")
      userAgreement.innerHTML = "NUTZERVEREINBARUNG"
      userAgreement.style.cursor = "pointer"
      userAgreement.style.padding = "13px"
      userAgreement.addEventListener("click", () => window.location.assign("/nutzervereinbarung/"))
      footer.append(userAgreement)
    })


  </script>
</body>


</html>
