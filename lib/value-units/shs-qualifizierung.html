<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link rel="shortcut icon" href="/public/getyour-logo.svg" />
    <title>SHS Anlagenbetreiber Qualifizierung</title>

  </head>
  <body style="margin: 0; background: #ebebeb; font-family: sans-serif; background-image: url('/felix/shs/public/qualifizierung-bg.png'); background-repeat: no-repeat; background-size: cover;">

    <header></header>

    <div class="info"></div>

    <div class="funnel-placeholder"></div>

    <footer></footer>

    <script type="module">
      import { HeaderField } from "/js/HeaderField.js"
      import { InfoField } from "/js/InfoField.js"
      import { FunnelField } from "/js/FunnelField.js"
      import { Helper } from "/js/Helper.js"
      import { Request } from "/js/Request.js"
      import { DivField } from "/js/DivField.js"

      const getFunnel = {}
      getFunnel.url = "/consumer/open/"
      getFunnel.method = "get"
      getFunnel.name = "shs"
      getFunnel.type = "funnel"
      getFunnel.email = await Request.email()
      getFunnel.localStorageId = await Request.localStorageId()
      const res = await Request.middleware(getFunnel)

      if (res.status !== 200) {
        alert("Leider können wir Ihnen im Moment kein Angebot machen. Bitte melden Sie sich nochmal an und versuchen es erneut. Sollten Sie weiterhin kein Angebot erhalten, bitte kontaktieren Sie uns unter 'datenschutz@get-your.de'")
        window.location.assign("/home/")
        throw new Error("get funnel failed")
      }

      const funnel = JSON.parse(res.response)

      const shsFunnel = JSON.parse(window.localStorage.getItem("shsFunnel"))
      if (shsFunnel !== null) {
        if (shsFunnel.value !== undefined) {
          if (shsFunnel.questionIndex >= shsFunnel.questions.length - 1) {
            const confirm = window.confirm("Wenn Sie fortfahren, werden Ihre lokalen Daten gelöscht.\n\nWollen Sie fortfahren?")
            if (confirm === true) {
              window.localStorage.removeItem("shsFunnel")
            } else {
              window.location.assign("/felix/shs/abfrage-haus/")
              throw new Error("funnel exist")
            }
          } else window.localStorage.removeItem("shsFunnel")
        }
      }

      const headerField = new HeaderField()
      .withImage(img => {
        img.src = "/felix/shs/public/shslogo.png"
        img.alt = "SHS Express Logo"
        img.style.cursor = "pointer"
        img.style.width = "144px"
        img.addEventListener("click", () => window.location.reload())
      })
      .withType(header => {
        header.style.position = "fixed"
        header.style.top = "0"
        header.style.left = "0"
        header.style.backgroundColor = "white"
        header.style.width = "100%"
      })
      .build()

      const infoField = new InfoField("info")
      .withSuccess(/*html*/`
        <div style="font-size: 21px; margin-bottom: 55px"> Jetzt <span style="color: #f27f2a;">Unabhängig</span> von öffentlichen Energieversorgern werden!</div>
        <div style="margin-bottom: 21px">Erstellen Sie sich einfach ihr maßgeschneidertes Energiekonzept.</div>
        <div>Kostenlos & unverbindlich.</div>
      `)
      .build()
      .withType(info => {
        info.style.margin = "144px 34px 34px 34px"
      })


      const funnelField = new FunnelField("funnel-placeholder")
      .withFunnel(funnel)
      .withClickOnAnswerEventListener((questionIndex, answerIndex) => {

        if (questionIndex === 0 && answerIndex === 1) {
          window.location.assign("/felix/shs/")
          return
        }

        if (questionIndex === 1 && answerIndex === 1) {
          window.location.assign("/felix/shs/")
          return
        }

        if (questionIndex === 1 && answerIndex === 3) {
          window.location.assign("/felix/shs/")
          return
        }

        if (questionIndex === 10 && answerIndex === 1) {
          const shsFunnel = JSON.parse(window.localStorage.getItem("shsFunnel"))
          const q7 = shsFunnel.value.q7
          const q8 = shsFunnel.value.q8
          const q9 = shsFunnel.value.q9
          if (q7 === 1 && q8 === 1 && q9 === 1) {
            window.location.assign("/felix/shs/")
            return
          }
        }

        if (questionIndex === 11 && answerIndex === 1) {
          window.location.assign("/felix/shs/")
          return
        }

        funnel.questionIndex = funnel.questionIndex + 1
        funnelField.withFunnel(funnel)
      })
      .withFunnelCompleted(() => window.location.assign("/felix/shs/abfrage-haus/"))

      Helper.createSHSFooter()

    </script>

  </body>
</html>
