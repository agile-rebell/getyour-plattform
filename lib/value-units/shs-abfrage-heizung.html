<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="shortcut icon" href="/public/getyour-logo.svg" />
    <title>SHS Funnel Abfrage Heizung</title>


    <style>
      body {
        margin: 0;
        line-height: 1.2;
        font-family: sans-serif;
      }
    </style>


  </head>
  <body>


    <header></header>

    <h1 class="heating-title"></h1>
    <div class="heizungWomitHeizen"></div>
    <div class="heizungWieHeizen"></div>
    <div class="heizungVorlauf"></div>
    <div class="heizungWarm"></div>
    <div class="heizungKosten"></div>


    <h2 class="location-title"></h2>
    <div class="heizungWaermePumpeBild"></div>
    <div class="heizungWasserSpeicherBild"></div>
    <div class="heizungStromSpeicherBild"></div>
    <div class="heizungBetriebsTemperaturBekannt"></div>
    <div class="heizungEintrittZehnMeter"></div>
    <div class="heizungGleichesGebaeude"></div>
    <div class="heizungGleicherRaum"></div>
    <div class="heizungMehrAlsZwanzigMeter"></div>


    <h2 class="planning-title"></h2>
    <div class="heizungSpeicherKellerEtage"></div>
    <div class="heizungSpeicherErsteEtage"></div>
    <div class="heizungSpeicherZweiteEtage"></div>
    <div class="heizungSpeicherDritteEtage"></div>


    <h2 class="meter-cabinet-title"></h2>
    <div class="heizungZaehlerKellerEtage"></div>
    <div class="heizungZaehlerErsteEtage"></div>
    <div class="heizungZaehlerZweiteEtage"></div>
    <div class="heizungZaehlerDritteEtage"></div>


    <div class="save-and-proceed-button"></div>

    <footer></footer>


    <script type="module">
      import { HeaderField } from "/js/HeaderField.js"
      import { CheckboxField } from "/js/CheckboxField.js"
      import { DivField } from "/js/DivField.js"
      import { FileField } from "/js/FileField.js"
      import { Helper } from "/js/Helper.js"
      import { NumberField } from "/js/NumberField.js"
      import { SelectionField } from "/js/SelectionField.js"
      import { Request } from "/js/Request.js"


      const funnel = JSON.parse(window.localStorage.getItem("shsFunnel"))
      if (
        funnel === null ||
        funnel.value === undefined ||
        funnel.questionIndex < funnel.questions.length - 1
        ) {
        window.location.assign("/felix/shs/qualifizierung/")
        throw new Error("funnel not found")
      }


      const header = document.querySelector("header")
      header.style.display = "flex"
      header.style.flexDirection = "column"
      header.style.justifyContent = "space-between"

      const headerLogo = document.createElement("img")
      headerLogo.src = "/felix/shs/public/shslogo.png"
      headerLogo.alt = "SHS Express Logo"
      headerLogo.style.margin = "8px 34px"
      headerLogo.style.width = "144px"
      headerLogo.style.cursor = "pointer"
      headerLogo.addEventListener("click", () => window.history.back())
      header.append(headerLogo)


      const navContainer = document.createElement("div")
      navContainer.style.display = "flex"
      navContainer.style.justifyContent = "space-evenly"
      navContainer.style.boxShadow = "0 3px 5px rgba(0, 0, 0, 0.13)"

      const button1 = document.createElement("div")
      button1.classList.add("button-1")
      button1.style.display = "flex"
      button1.style.flexDirection = "column"
      button1.style.alignItems = "center"
      button1.style.justifyContent = "center"
      button1.style.width = "89px"
      button1.style.margin = "13px"
      button1.style.cursor = "pointer"
      button1.addEventListener("click", async() => await checkAndProceed("/felix/shs/abfrage-haus/"))

      const title1 = document.createElement("div")
      title1.innerHTML = "Haus"
      button1.append(title1)

      const index1 = document.createElement("div")
      index1.innerHTML = "1"
      index1.style.color = "white"

      const state1 = document.createElement("div")
      state1.style.display = "flex"
      state1.style.justifyContent = "center"
      state1.style.alignItems = "center"
      state1.style.width = "55px"
      state1.style.height = "34px"
      state1.style.margin = "13px 0"
      state1.style.backgroundColor = "#11841e"
      button1.append(state1)

      state1.append(index1)

      navContainer.append(button1)


      const button2 = document.createElement("div")
      button2.classList.add("button-1")
      button2.style.display = "flex"
      button2.style.flexDirection = "column"
      button2.style.justifyContent = "center"
      button2.style.alignItems = "center"
      button2.style.width = "89px"
      button2.style.margin = "13px"
      button2.style.cursor = "pointer"
      button2.addEventListener("click", async() => await checkAndProceed("/felix/shs/abfrage-heizung/"))

      const title2 = document.createElement("div")
      title2.innerHTML = "Heizung"
      button2.append(title2)

      const index2 = document.createElement("div")
      index2.innerHTML = "2"
      index2.style.color = "white"

      const state2 = document.createElement("div")
      state2.style.display = "flex"
      state2.style.justifyContent = "center"
      state2.style.alignItems = "center"
      state2.style.width = "55px"
      state2.style.height = "34px"
      state2.style.margin = "13px 0"
      state2.style.backgroundColor = "#11841e"
      button2.append(state2)

      state2.append(index2)

      navContainer.append(button2)



      const button3 = document.createElement("div")
      button3.classList.add("button-1")
      button3.style.display = "flex"
      button3.style.flexDirection = "column"
      button3.style.justifyContent = "center"
      button3.style.alignItems = "center"
      button3.style.width = "89px"
      button3.style.margin = "13px"
      button3.style.cursor = "pointer"
      button3.addEventListener("click", async() => await checkAndProceed("/felix/shs/abfrage-strom/"))

      const title3 = document.createElement("div")
      title3.innerHTML = "Strom"
      button3.append(title3)

      const index3 = document.createElement("div")
      index3.innerHTML = "3"

      const state3 = document.createElement("div")
      state3.style.display = "flex"
      state3.style.justifyContent = "center"
      state3.style.alignItems = "center"
      state3.style.width = "55px"
      state3.style.height = "34px"
      state3.style.margin = "13px 0"
      state3.style.backgroundColor = "#cfd4e2"
      button3.append(state3)

      state3.append(index3)

      navContainer.append(button3)



      const button4 = document.createElement("div")
      button4.classList.add("button-1")
      button4.style.display = "flex"
      button4.style.flexDirection = "column"
      button4.style.justifyContent = "center"
      button4.style.alignItems = "center"
      button4.style.width = "89px"
      button4.style.margin = "13px"
      button4.style.cursor = "pointer"
      button4.addEventListener("click", async() => await checkAndProceed("/felix/shs/abfrage-technisches/"))

      const title4 = document.createElement("div")
      title4.innerHTML = "Technisches"
      button4.append(title4)

      const index4 = document.createElement("div")
      index4.innerHTML = "4"

      const state4 = document.createElement("div")
      state4.style.display = "flex"
      state4.style.justifyContent = "center"
      state4.style.alignItems = "center"
      state4.style.width = "55px"
      state4.style.height = "34px"
      state4.style.margin = "13px 0"
      state4.style.backgroundColor = "#cfd4e2"
      button4.append(state4)

      state4.append(index4)

      navContainer.append(button4)


      header.append(navContainer)

      let observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting === false) {
            navContainer.style.position = "fixed"
            navContainer.style.top = "0"
            navContainer.style.left = "0"
            navContainer.style.zIndex = "1"
            navContainer.style.backgroundColor = "white"
            navContainer.style.width = "100%"
          }

          if (entry.isIntersecting === true) {
            navContainer.style.position = "static"
          }

        })
      }, {threshold: 0})
      observer.observe(headerLogo)


      document.querySelectorAll(".heating-title").forEach(title => {
        title.innerHTML = "Heizungsanlage"
        title.style.margin = "144px 34px 34px 34px"
        title.style.fontWeight = "normal"
      })

      const heizungWomitHeizen = new SelectionField("heizungWomitHeizen")
      .withLabel(label => label.innerHTML = "Womit heizen Sie aktuell")
      .withOptions(["Erdgas", "Heizöl", "Wärmepumpe", "Holz/Kohle", "Pellets", "Flüssiggas", "Strom", "Andere"])
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Wenn wir wissen, wie der Kunde derzeit heizt, können wir die Leistung der neuen Heizung oder Wärmepumpe anpassen. Wenn der Kunde beispielsweise derzeit eine Ölheizung verwendet, benötigt er möglicherweise eine leistungsstärkere Wärmepumpe als jemand, der mit einer elektrischen Heizung heizt."
          }
        })
      })
      .onInput(async() => {
        heizungWomitHeizen.withStorage(value => {
          funnel.value[heizungWomitHeizen.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungWomitHeizen.withStorage(value => {
        funnel.value[heizungWomitHeizen.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })



      const heizungWieHeizen = new SelectionField("heizungWieHeizen")
      .withLabel(label => label.innerHTML = "Wie heizen Sie")
      .withOptions(["Radiatoren/Konvektoren", "Flachheizkörper", "Fußboden-/Wandheizung", "Andere"])
      .withType(select => {
        select.disabled = true
        const q9 = funnel.value.q9
        if (q9 === 0) {
          select.disabled = false
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Falls der Kunde bereits eine bestehende Heizung hat, die in gutem Zustand ist, können wir möglicherweise das vorhandene Heizsystem mit dem neuen Energiesystem kombinieren, um die Effizienz zu maximieren und die Kosten zu senken. Durch die Verwendung eines Energiesystems, das auf die spezifischen Bedürfnisse des Kunden zugeschnitten ist, können wir möglicherweise die Heizkosten senken und dem Kunden langfristig Einsparungen bringen."
          }
        })
      })
      .onInput(async() => {
        heizungWieHeizen.withStorage(value => {
          funnel.value[heizungWieHeizen.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungWieHeizen.withStorage(value => {
        funnel.value[heizungWieHeizen.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const heizungVorlauf = new NumberField("heizungVorlauf")
      .withLabel(label => label.innerHTML = "Vorlauftemperatur ihrer Heizung (min)")
      .withType(number => {
        number.disabled = true
        const q9 = funnel.value.q9
        if (q9 === 0) {
          number.disabled = false
          number.placeholder = "in Grad"
          number.required = true
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Eine Wärmepumpe muss genügend Heizleistung liefern, um das Haus bei jeder Außentemperatur zu heizen, die in der Region üblich ist. Wenn die Vorlauftemperatur zu hoch ist, benötigt die Wärmepumpe mehr Energie, um diese Temperatur zu erreichen, was zu einem höheren Energieverbrauch führen kann. Wenn die Vorlauftemperatur zu niedrig ist, kann die Heizleistung der Wärmepumpe nicht ausreichen, um das Haus bei kaltem Wetter zu heizen."
          }
        })
      })
      .onInput(async() => {
        heizungVorlauf.withStorage(value => {
          funnel.value[heizungVorlauf.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungVorlauf.withStorage(value => {
        funnel.value[heizungVorlauf.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })



      const heizungWarm = new SelectionField("heizungWarm")
      .withLabel(label => label.innerHTML = "Wie wird Warmwasser erzeugt")
      .withOptions(["Zentral über Heizung", "Separat (z.B. Durchlauferhitzer)", "Solarthermie", "Andere"])
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Es gibt verschiedene Möglichkeiten, Warmwasser zu erzeugen, wie beispielsweise durch einen Boiler, eine Gastherme oder eine Solarthermieanlage. Jede dieser Methoden hat unterschiedliche Anforderungen an das Energiesystem und beeinflusst den Strom- oder Energiebedarf des Hauses. Wenn wir wissen, wie Warmwasser erzeugt wird, können wir das Energiesystem so planen, dass es optimal auf die Bedürfnisse des Hauses abgestimmt ist. Auf diese Weise kann eine höhere Effizienz des Systems erreicht werden, was langfristig auch zu Einsparungen bei den Energiekosten führen kann."
          }
        })
      })
      .onInput(async() => {
        heizungWarm.withStorage(value => {
          funnel.value[heizungWarm.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungWarm.withStorage(value => {
        funnel.value[heizungWarm.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const heizungKosten = new NumberField("heizungKosten")
      .withLabel(label => label.innerHTML = "Jährliche Heizkosten in EUR")
      .withType(number => {
        number.min = 0
        number.placeholder = "in Euro"
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Indem man weiß, wie viel Geld der Kunde jedes Jahr für Heizung und Warmwasser ausgibt, kann man besser einschätzen, wie viel Energie das neue System erzeugen und speichern muss, um die Heizkosten des Kunden zu reduzieren. Wenn zum Beispiel die jährlichen Heizkosten des Kunden sehr hoch sind, kann es sinnvoll sein, ein größeres System zu installieren, um eine höhere Energieeinsparung zu erzielen. Darüber hinaus kann das Wissen um die jährlichen Heizkosten auch helfen, die Amortisationszeit des neuen Systems zu berechnen. Wenn das neue System dazu beitragen kann, die Heizkosten des Kunden signifikant zu reduzieren, wird es schneller rentabel und der Kunde spart langfristig Geld."
          }
        })
      })
      .onInput(async() => {
        heizungKosten.withStorage(value => {
          funnel.value[heizungKosten.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungKosten.withStorage(value => {
        funnel.value[heizungKosten.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      document.querySelectorAll(".location-title").forEach(title => {
        title.innerHTML = "Aufstellungsort"
        title.style.margin = "144px 34px 34px 34px"
        title.style.fontWeight = "normal"
      })


      const heizungWaermePumpeBild = new FileField("heizungWaermePumpeBild")
      .withLabel(label => label.innerHTML = "Wärmepumpe")
      .withType(file => {
        file.disabled = true
        const q9 = funnel.value.q9
        if (q9 === 0) {
          file.disabled = false
          file.required = true
          file.accept = "image/jpeg, image/png"
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Die Wärmepumpe wird im Außenbereich aufgestellt. Sollte kein Betonfundament/Streifen vorhanden sein müssen mit 500€ Mehrkosten gerechnet werden"
          }
        })
      })
      .onInput(() => {
        heizungWaermePumpeBild.withStorage(async value => {

          let array = []
          const allowedMimeTypes = ["image/jpeg", "image/png"]
          const allowedExtensions = ["jpg", "jpeg", "png"]
          for (let i = 0; i < value.length; i++) {


            await Helper.verifyFileMimeTypes(value[i], allowedMimeTypes)
            .catch(error => {
              alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
              Helper.setNotValidStyle(document.querySelector(heizungWaermePumpeBild.inputSelector))
              throw error
            })

            await Helper.verifyFileExtension(value[i], allowedExtensions)
            .catch(error => {
              alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
              Helper.setNotValidStyle(document.querySelector(heizungWaermePumpeBild.inputSelector))
              throw error
            })

            const dataUrl = await Helper.convertImageFileToDataUrl(value[i])
            const dataUrlSize = Helper.calculateDataUrlSize(dataUrl)
            if (dataUrlSize > 1024 * 1024) {
              alert("Bild ist zu groß.")
              Helper.setNotValidStyle(document.querySelector(heizungWaermePumpeBild.inputSelector))
              throw new Error("image too large")
            }

            array.push({
              name: value[i].name,
              type: value[i].type,
              size: dataUrlSize,
              lastModified: Date.now(),
              dataUrl: dataUrl,
            })

          }

          if (array.length > 0) {
            funnel.value[heizungWaermePumpeBild.name] = array
            window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
          }

        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungWaermePumpeBild.withStorage(async value => {



        let array = []
        const allowedMimeTypes = ["image/jpeg", "image/png"]
        const allowedExtensions = ["jpg", "jpeg", "png"]
        for (let i = 0; i < value.length; i++) {


          await Helper.verifyFileMimeTypes(value[i], allowedMimeTypes)
          .catch(error => {
            alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
            Helper.setNotValidStyle(document.querySelector(heizungWaermePumpeBild.inputSelector))
            throw error
          })

          await Helper.verifyFileExtension(value[i], allowedExtensions)
          .catch(error => {
            alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
            Helper.setNotValidStyle(document.querySelector(heizungWaermePumpeBild.inputSelector))
            throw error
          })

          const dataUrl = await Helper.convertImageFileToDataUrl(value[i])
          const dataUrlSize = Helper.calculateDataUrlSize(dataUrl)
          if (dataUrlSize > 1024 * 1024) {
            alert("Bild ist zu groß.")
            Helper.setNotValidStyle(document.querySelector(heizungWaermePumpeBild.inputSelector))
            throw new Error("image too large")
          }

          array.push({
            name: value[i].name,
            type: value[i].type,
            size: dataUrlSize,
            lastModified: Date.now(),
            dataUrl: dataUrl,
          })

        }

        if (array.length > 0) {
          funnel.value[heizungWaermePumpeBild.name] = array
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        }

      })


      const heizungWasserSpeicherBild = new FileField("heizungWasserSpeicherBild")
      .withLabel(label => label.innerHTML = "Wasserspeicher")
      .withType(file => {
        file.disabled = true
        const q9 = funnel.value.q9
        if (q9 === 0) {
          file.disabled = false
          file.required = true
          file.accept = "image/jpeg, image/png"
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Eventuell Ort des vorhandenen Warmwasserspeichers"
          }
        })
      })
      .onInput(() => {
        heizungWasserSpeicherBild.withStorage(async value => {


          let array = []
          const allowedMimeTypes = ["image/jpeg", "image/png"]
          const allowedExtensions = ["jpg", "jpeg", "png"]
          for (let i = 0; i < value.length; i++) {


            await Helper.verifyFileMimeTypes(value[i], allowedMimeTypes)
            .catch(error => {
              alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
              Helper.setNotValidStyle(document.querySelector(heizungWasserSpeicherBild.inputSelector))
              throw error
            })

            await Helper.verifyFileExtension(value[i], allowedExtensions)
            .catch(error => {
              alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
              Helper.setNotValidStyle(document.querySelector(heizungWasserSpeicherBild.inputSelector))
              throw error
            })

            const dataUrl = await Helper.convertImageFileToDataUrl(value[i])
            const dataUrlSize = Helper.calculateDataUrlSize(dataUrl)
            if (dataUrlSize > 1024 * 1024) {
              alert("Bild ist zu groß.")
              Helper.setNotValidStyle(document.querySelector(heizungWasserSpeicherBild.inputSelector))
              throw new Error("image too large")
            }

            array.push({
              name: value[i].name,
              type: value[i].type,
              size: dataUrlSize,
              lastModified: Date.now(),
              dataUrl: dataUrl,
            })

          }

          if (array.length > 0) {
            funnel.value[heizungWasserSpeicherBild.name] = array
            window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
          }

        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungWasserSpeicherBild.withStorage(async value => {

        let array = []
        const allowedMimeTypes = ["image/jpeg", "image/png"]
        const allowedExtensions = ["jpg", "jpeg", "png"]
        for (let i = 0; i < value.length; i++) {


          await Helper.verifyFileMimeTypes(value[i], allowedMimeTypes)
          .catch(error => {
            alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
            Helper.setNotValidStyle(document.querySelector(heizungWasserSpeicherBild.inputSelector))
            throw error
          })

          await Helper.verifyFileExtension(value[i], allowedExtensions)
          .catch(error => {
            alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
            Helper.setNotValidStyle(document.querySelector(heizungWasserSpeicherBild.inputSelector))
            throw error
          })

          const dataUrl = await Helper.convertImageFileToDataUrl(value[i])
          const dataUrlSize = Helper.calculateDataUrlSize(dataUrl)
          if (dataUrlSize > 1024 * 1024) {
            alert("Bild ist zu groß.")
            Helper.setNotValidStyle(document.querySelector(heizungWasserSpeicherBild.inputSelector))
            throw new Error("image too large")
          }

          array.push({
            name: value[i].name,
            type: value[i].type,
            size: dataUrlSize,
            lastModified: Date.now(),
            dataUrl: dataUrl,
          })

        }

        if (array.length > 0) {
          funnel.value[heizungWasserSpeicherBild.name] = array
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        }

      })



      const heizungStromSpeicherBild = new FileField("heizungStromSpeicherBild")
      .withLabel(label => label.innerHTML = "Stromspeicher")
      .withType(file => {
        file.disabled = true
        const q9 = funnel.value.q9
        if (q9 === 0) {
          file.disabled = false
          file.required = true
          file.accept = "image/jpeg, image/png"
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "In der Nähe des Zählerschranks, höchstens 1 Etage unterschied"
          }
        })
      })
      .onInput(() => {
        heizungStromSpeicherBild.withStorage(async value => {

          let array = []
          const allowedMimeTypes = ["image/jpeg", "image/png"]
          const allowedExtensions = ["jpg", "jpeg", "png"]
          for (let i = 0; i < value.length; i++) {


            await Helper.verifyFileMimeTypes(value[i], allowedMimeTypes)
            .catch(error => {
              alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
              Helper.setNotValidStyle(document.querySelector(heizungStromSpeicherBild.inputSelector))
              throw error
            })

            await Helper.verifyFileExtension(value[i], allowedExtensions)
            .catch(error => {
              alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
              Helper.setNotValidStyle(document.querySelector(heizungStromSpeicherBild.inputSelector))
              throw error
            })

            const dataUrl = await Helper.convertImageFileToDataUrl(value[i])
            const dataUrlSize = Helper.calculateDataUrlSize(dataUrl)
            if (dataUrlSize > 1024 * 1024) {
              alert("Bild ist zu groß.")
              Helper.setNotValidStyle(document.querySelector(heizungStromSpeicherBild.inputSelector))
              throw new Error("image too large")
            }

            array.push({
              name: value[i].name,
              type: value[i].type,
              size: dataUrlSize,
              lastModified: Date.now(),
              dataUrl: dataUrl,
            })

          }

          if (array.length > 0) {
            funnel.value[heizungStromSpeicherBild.name] = array
            window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
          }

        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungStromSpeicherBild.withStorage(async value => {

        let array = []
        const allowedMimeTypes = ["image/jpeg", "image/png"]
        const allowedExtensions = ["jpg", "jpeg", "png"]
        for (let i = 0; i < value.length; i++) {


          await Helper.verifyFileMimeTypes(value[i], allowedMimeTypes)
          .catch(error => {
            alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
            Helper.setNotValidStyle(document.querySelector(heizungStromSpeicherBild.inputSelector))
            throw error
          })

          await Helper.verifyFileExtension(value[i], allowedExtensions)
          .catch(error => {
            alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
            Helper.setNotValidStyle(document.querySelector(heizungStromSpeicherBild.inputSelector))
            throw error
          })

          const dataUrl = await Helper.convertImageFileToDataUrl(value[i])
          const dataUrlSize = Helper.calculateDataUrlSize(dataUrl)
          if (dataUrlSize > 1024 * 1024) {
            alert("Bild ist zu groß.")
            Helper.setNotValidStyle(document.querySelector(heizungStromSpeicherBild.inputSelector))
            throw new Error("image too large")
          }

          array.push({
            name: value[i].name,
            type: value[i].type,
            size: dataUrlSize,
            lastModified: Date.now(),
            dataUrl: dataUrl,
          })

        }

        if (array.length > 0) {
          funnel.value[heizungStromSpeicherBild.name] = array
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        }

      })


      const heizungBetriebsTemperaturBekannt = new CheckboxField("heizungBetriebsTemperaturBekannt")
      .withLabel(label => label.innerHTML = "Mir ist bekannt, dass die Raumtemperatur beim Speicherort bei +5 bis 40 Grad liegt")
      .withAfterCheckbox(after => after.innerHTML = "Ja, das ist mir bekannt.")
      .withType(checkbox => {
        checkbox.disabled = true
        const q8 = funnel.value.q8
        if (q8 === 0) {
          checkbox.disabled = false
          checkbox.required = true
        }
      })
      .onInput(async() => {
        heizungBetriebsTemperaturBekannt.withStorage(value => {
          funnel.value[heizungBetriebsTemperaturBekannt.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungBetriebsTemperaturBekannt.withStorage(value => {
        funnel.value[heizungBetriebsTemperaturBekannt.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })

      const heizungEintrittZehnMeter = new SelectionField("heizungEintrittZehnMeter")
      .withLabel(label => label.innerHTML = "Beträgt die DC-Kabelführung von Hausantritt bis Speicher mehr als 10")
      .withOptions(["Nein", "Ja"])
      .withType(select => {
        select.disabled = true
        const q7 = funnel.value.q7
        const q8 = funnel.value.q8
        const q9 = funnel.value.q9
        if (q7 === 0 || q8 === 0 || q9 === 0) {
          select.disabled = false
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Wenn die Kabellänge mehr als 10 Meter beträgt, müssen wir möglicherweise größere Kabelquerschnitte verwenden, um sicherzustellen, dass genügend Energie zum Speicher gelangen kann. Dies kann sich auch auf die Kosten für die Installation auswirken."
          }
        })
      })
      .onInput(async() => {
        heizungEintrittZehnMeter.withStorage(value => {
          funnel.value[heizungEintrittZehnMeter.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungEintrittZehnMeter.withStorage(value => {
        funnel.value[heizungEintrittZehnMeter.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })



      const heizungGleichesGebaeude = new SelectionField("heizungGleichesGebaeude")
      .withLabel(label => label.innerHTML = "Befinden sich die Module auf dem Haus, in dem der Speicher ist")
      .withOptions(["Ja", "Nein"])
      .withType(select => {
        select.disabled = true
        const q7 = funnel.value.q7
        const q8 = funnel.value.q8
        const q9 = funnel.value.q9
        if (q7 === 0 || q8 === 0 || q9 === 0) {
          select.disabled = false
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Wenn die Module auf einem anderen Dach installiert werden, kann dies höheren Kosten führen, da der Kunde eventuell zusätzliche Erdarbeiten im Vorab vornehmen muss."
          }
        })
      })
      .onInput(async() => {
        heizungGleichesGebaeude.withStorage(value => {
          funnel.value[heizungGleichesGebaeude.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungGleichesGebaeude.withStorage(value => {
        funnel.value[heizungGleichesGebaeude.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const heizungGleicherRaum = new SelectionField("heizungGleicherRaum")
      .withLabel(label => label.innerHTML = "Kann Speicher und WR im Raum vom Zählerschrank montiert werden")
      .withOptions(["Ja", "Nein, 1 - 2 Räume entfernt", "Nein, mehr als 2 Räume entfernt"])
      .withType(select => {
        select.disabled = true
        const q7 = funnel.value.q7
        const q8 = funnel.value.q8
        if (q7 === 0 || q8 === 0) {
          select.disabled = false
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Der Wechselrichter muss in der Nähe des Zählerschrankes installiert werden, damit der Strom, der von der Photovoltaikanlage erzeugt wird, ins Stromnetz eingespeist werden kann. Wenn der Speicher und Wechselrichter nicht im gleichen Raum wie der Zählerschrank montiert werden können, müssen zusätzliche Kabel verlegt werden, um den Wechselrichter mit dem Zählerschrank zu verbinden. Dies kann zusätzliche Kosten verursachen und die Installationszeit verlängern."
          }
        })
      })
      .onInput(async() => {
        heizungGleicherRaum.withStorage(value => {
          funnel.value[heizungGleicherRaum.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungGleicherRaum.withStorage(value => {
        funnel.value[heizungGleicherRaum.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const heizungMehrAlsZwanzigMeter = new SelectionField("heizungMehrAlsZwanzigMeter")
      .withLabel(label => label.innerHTML = "Kabellänge vom Speicher bis Zähler mehr als 20m")
      .withOptions(["Nein", "20-30m", "30-40m", "40-50m", "mehr als 50m"])
      .withType(select => {
        select.disabled = true
        const q7 = funnel.value.q7
        const q8 = funnel.value.q8
        if (q7 === 0 || q8 === 0) {
          select.disabled = false
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Wenn die Kabellänge die 10 Meter überschreitet, kann dies höheren Kosten führen, da das Montageteam Extrakabel installieren muss."
          }
        })
      })
      .onInput(async() => {
        heizungMehrAlsZwanzigMeter.withStorage(value => {
          funnel.value[heizungMehrAlsZwanzigMeter.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungMehrAlsZwanzigMeter.withStorage(value => {
        funnel.value[heizungMehrAlsZwanzigMeter.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      document.querySelectorAll(".planning-title").forEach(title => {
        title.innerHTML = "Etage des geplanten Speicher-/Wechselrichterstandort"
        title.style.margin = "144px 34px 34px 34px"
        title.style.fontWeight = "normal"
      })


      const heizungSpeicherKellerEtage = new CheckboxField("heizungSpeicherKellerEtage")
      .withLabel(label => label.innerHTML = "Keller")
      .withType(checkbox => {
        checkbox.disabled = true
        const q7 = funnel.value.q7
        const q8 = funnel.value.q8
        if (q7 === 0 || q8 === 0) {
          checkbox.disabled = false
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "In welcher Etage befindet sich ihr geplanter Speicher-/Wechselrichterstandort?"
          }
        })
      })
      .onInput(async() => {
        heizungSpeicherKellerEtage.withStorage(value => {
          funnel.value[heizungSpeicherKellerEtage.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungSpeicherKellerEtage.withStorage(value => {
        funnel.value[heizungSpeicherKellerEtage.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const heizungSpeicherErsteEtage = new CheckboxField("heizungSpeicherErsteEtage")
      .withLabel(label => label.innerHTML = "Erdgeschoss")
      .withType(checkbox => {
        checkbox.disabled = true
        const q7 = funnel.value.q7
        const q8 = funnel.value.q8
        if (q7 === 0 || q8 === 0) {
          checkbox.disabled = false
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "In welcher Etage befindet sich ihr geplanter Speicher-/Wechselrichterstandort?"
          }
        })
      })
      .onInput(async() => {
        heizungSpeicherErsteEtage.withStorage(value => {
          funnel.value[heizungSpeicherErsteEtage.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungSpeicherErsteEtage.withStorage(value => {
        funnel.value[heizungSpeicherErsteEtage.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const heizungSpeicherZweiteEtage = new CheckboxField("heizungSpeicherZweiteEtage")
      .withLabel(label => label.innerHTML = "2. Etage")
      .withType(checkbox => {
        checkbox.disabled = true
        const q7 = funnel.value.q7
        const q8 = funnel.value.q8
        if (q7 === 0 || q8 === 0) {
          checkbox.disabled = false
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "In welcher Etage befindet sich ihr geplanter Speicher-/Wechselrichterstandort?"
          }
        })
      })
      .onInput(async() => {
        heizungSpeicherZweiteEtage.withStorage(value => {
          funnel.value[heizungSpeicherZweiteEtage.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungSpeicherZweiteEtage.withStorage(value => {
        funnel.value[heizungSpeicherZweiteEtage.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const heizungSpeicherDritteEtage = new CheckboxField("heizungSpeicherDritteEtage")
      .withLabel(label => label.innerHTML = "3. Etage")
      .withType(checkbox => {
        checkbox.disabled = true
        const q7 = funnel.value.q7
        const q8 = funnel.value.q8
        if (q7 === 0 || q8 === 0) {
          checkbox.disabled = false
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "In welcher Etage befindet sich ihr geplanter Speicher-/Wechselrichterstandort?"
          }
        })
      })
      .onInput(async() => {
        heizungSpeicherDritteEtage.withStorage(value => {
          funnel.value[heizungSpeicherDritteEtage.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungSpeicherDritteEtage.withStorage(value => {
        funnel.value[heizungSpeicherDritteEtage.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })



      document.querySelectorAll(".meter-cabinet-title").forEach(title => {
        title.innerHTML = "Etage Ihres Zählerschranks"
        title.style.margin = "144px 34px 34px 34px"
        title.style.fontWeight = "normal"
      })


      const heizungZaehlerKellerEtage = new CheckboxField("heizungZaehlerKellerEtage")
      .withLabel(label => label.innerHTML = "Keller")
      .withType(checkbox => {
        checkbox.disabled = true
        const q7 = funnel.value.q7
        const q8 = funnel.value.q8
        if (q7 === 0 || q8 === 0) {
          checkbox.disabled = false
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "In welcher Etage befindet sich ihr Zählerschrank?"
          }
        })
      })
      .onInput(async() => {
        heizungZaehlerKellerEtage.withStorage(value => {
          funnel.value[heizungZaehlerKellerEtage.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungZaehlerKellerEtage.withStorage(value => {
        funnel.value[heizungZaehlerKellerEtage.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const heizungZaehlerErsteEtage = new CheckboxField("heizungZaehlerErsteEtage")
      .withLabel(label => label.innerHTML = "Erdgeschoss")
      .withType(checkbox => {
        checkbox.disabled = true
        const q7 = funnel.value.q7
        const q8 = funnel.value.q8
        if (q7 === 0 || q8 === 0) {
          checkbox.disabled = false
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "In welcher Etage befindet sich ihr Zählerschrank?"
          }
        })
      })
      .onInput(async() => {
        heizungZaehlerErsteEtage.withStorage(value => {
          funnel.value[heizungZaehlerErsteEtage.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungZaehlerErsteEtage.withStorage(value => {
        funnel.value[heizungZaehlerErsteEtage.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const heizungZaehlerZweiteEtage = new CheckboxField("heizungZaehlerZweiteEtage")
      .withLabel(label => label.innerHTML = "2. Etage")
      .withType(checkbox => {
        checkbox.disabled = true
        const q7 = funnel.value.q7
        const q8 = funnel.value.q8
        if (q7 === 0 || q8 === 0) {
          checkbox.disabled = false
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "In welcher Etage befindet sich ihr Zählerschrank?"
          }
        })
      })
      .onInput(async() => {
        heizungZaehlerZweiteEtage.withStorage(value => {
          funnel.value[heizungZaehlerZweiteEtage.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungZaehlerZweiteEtage.withStorage(value => {
        funnel.value[heizungZaehlerZweiteEtage.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const heizungZaehlerDritteEtage = new CheckboxField("heizungZaehlerDritteEtage")
      .withLabel(label => label.innerHTML = "3. Etage")
      .withType(checkbox => {
        checkbox.disabled = true
        const q7 = funnel.value.q7
        const q8 = funnel.value.q8
        if (q7 === 0 || q8 === 0) {
          checkbox.disabled = false
        }
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "In welcher Etage befindet sich ihr Zählerschrank?"
          }
        })
      })
      .onInput(async() => {
        heizungZaehlerDritteEtage.withStorage(value => {
          funnel.value[heizungZaehlerDritteEtage.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      heizungZaehlerDritteEtage.withStorage(value => {
        funnel.value[heizungZaehlerDritteEtage.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const fields = [
        heizungWomitHeizen,
        heizungWieHeizen,
        heizungVorlauf,
        heizungWarm,
        heizungKosten,
        heizungWaermePumpeBild,
        heizungWasserSpeicherBild,
        heizungStromSpeicherBild,
        heizungBetriebsTemperaturBekannt,
        heizungEintrittZehnMeter,
        heizungGleichesGebaeude,
        heizungGleicherRaum,
        heizungMehrAlsZwanzigMeter,
        heizungSpeicherKellerEtage,
        heizungSpeicherErsteEtage,
        heizungSpeicherZweiteEtage,
        heizungSpeicherDritteEtage,
        heizungZaehlerKellerEtage,
        heizungZaehlerErsteEtage,
        heizungZaehlerZweiteEtage,
        heizungZaehlerDritteEtage,
      ]



      const speichernundweiterbutton = new DivField("save-and-proceed-button")
      .withType(div => {
        div.innerHTML = "Speichern und weiter"
        div.style.fontSize = "21px"
        div.style.margin = "144px 34px"
        div.style.backgroundColor = "#f7aa20"
        div.style.borderRadius = "13px"
        div.style.height = "89px"
        div.style.display = "flex"
        div.style.justifyContent = "center"
        div.style.alignItems = "center"
        div.addEventListener("mouseover", () => div.style.backgroundColor = "#f19d08")
        div.addEventListener("mouseout", () => div.style.backgroundColor = "#f7aa20")
      })
      .onClick(async () => await checkAndProceed("/felix/shs/abfrage-strom/"))



      Helper.createSHSFooter()

      async function checkAndProceed(path) {
        for (let i = 0; i < fields.length; i++) {
          await fields[i].withValidValue()
        }

        window.location.assign(path)
      }


    </script>

  </body>
</html>
