<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="shortcut icon" href="/public/getyour-logo.svg" />
    <title>SHS Funnel Abfrage Technisches</title>


    <style>
      body {
        margin: 0;
        line-height: 1.2;
        font-family: sans-serif;
      }
    </style>


  </head>
  <body>


    <header></header>

    <h1 class="technical-title"></h1>
    <div class="technischesWlan"></div>
    <div class="technischesErdkabel"></div>
    <div class="technischesPotentialAusgleich"></div>
    <div class="technischesHakBild"></div>
    <div class="technischesAnzahlHaks"></div>
    <div class="technischesHakStandort"></div>
    <div class="technischesHakFrei"></div>
    <div class="technischesZusatzInfo"></div>


    <div class="save-and-proceed-button"></div>

    <footer></footer>


    <script type="module">
      import { HeaderField } from "/js/HeaderField.js"
      import { CheckboxField } from "/js/CheckboxField.js"
      import { DivField } from "/js/DivField.js"
      import { FileField } from "/js/FileField.js"
      import { Helper } from "/js/Helper.js"
      import { SelectionField } from "/js/SelectionField.js"
      import { TextAreaField } from "/js/TextAreaField.js"
      import { Request } from "/js/Request.js"


      const funnel = JSON.parse(window.localStorage.getItem("shsFunnel"))
      if (
        funnel === null ||
        funnel.value === undefined ||
        funnel.questionIndex < funnel.questions.length - 1
        ) {
        window.location.assign("/felix/shs/qualifizierung/")
        throw new Error("funnel not found")
      }



      const header = document.querySelector("header")
      header.style.display = "flex"
      header.style.flexDirection = "column"
      header.style.justifyContent = "space-between"

      const headerLogo = document.createElement("img")
      headerLogo.src = "/felix/shs/public/shslogo.png"
      headerLogo.alt = "SHS Express Logo"
      headerLogo.style.margin = "8px 34px"
      headerLogo.style.width = "144px"
      headerLogo.style.cursor = "pointer"
      headerLogo.addEventListener("click", () => window.history.back())
      header.append(headerLogo)


      const navContainer = document.createElement("div")
      navContainer.style.display = "flex"
      navContainer.style.justifyContent = "space-evenly"
      navContainer.style.boxShadow = "0 3px 5px rgba(0, 0, 0, 0.13)"

      const button1 = document.createElement("div")
      button1.classList.add("button-1")
      button1.style.display = "flex"
      button1.style.flexDirection = "column"
      button1.style.alignItems = "center"
      button1.style.justifyContent = "center"
      button1.style.width = "89px"
      button1.style.margin = "13px"
      button1.style.cursor = "pointer"
      button1.addEventListener("click", async() => await checkAndProceed("/felix/shs/abfrage-haus/"))

      const title1 = document.createElement("div")
      title1.innerHTML = "Haus"
      button1.append(title1)

      const index1 = document.createElement("div")
      index1.innerHTML = "1"
      index1.style.color = "white"

      const state1 = document.createElement("div")
      state1.style.display = "flex"
      state1.style.justifyContent = "center"
      state1.style.alignItems = "center"
      state1.style.width = "55px"
      state1.style.height = "34px"
      state1.style.margin = "13px 0"
      state1.style.backgroundColor = "#11841e"
      button1.append(state1)

      state1.append(index1)

      navContainer.append(button1)


      const button2 = document.createElement("div")
      button2.classList.add("button-1")
      button2.style.display = "flex"
      button2.style.flexDirection = "column"
      button2.style.justifyContent = "center"
      button2.style.alignItems = "center"
      button2.style.width = "89px"
      button2.style.margin = "13px"
      button2.style.cursor = "pointer"
      button2.addEventListener("click", async() => await checkAndProceed("/felix/shs/abfrage-heizung/"))

      const title2 = document.createElement("div")
      title2.innerHTML = "Heizung"
      button2.append(title2)

      const index2 = document.createElement("div")
      index2.innerHTML = "2"
      index2.style.color = "white"

      const state2 = document.createElement("div")
      state2.style.display = "flex"
      state2.style.justifyContent = "center"
      state2.style.alignItems = "center"
      state2.style.width = "55px"
      state2.style.height = "34px"
      state2.style.margin = "13px 0"
      state2.style.backgroundColor = "#11841e"
      button2.append(state2)

      state2.append(index2)

      navContainer.append(button2)



      const button3 = document.createElement("div")
      button3.classList.add("button-1")
      button3.style.display = "flex"
      button3.style.flexDirection = "column"
      button3.style.justifyContent = "center"
      button3.style.alignItems = "center"
      button3.style.width = "89px"
      button3.style.margin = "13px"
      button3.style.cursor = "pointer"
      button3.addEventListener("click", async() => await checkAndProceed("/felix/shs/abfrage-strom/"))

      const title3 = document.createElement("div")
      title3.innerHTML = "Strom"
      button3.append(title3)

      const index3 = document.createElement("div")
      index3.innerHTML = "3"
      index3.style.color = "white"

      const state3 = document.createElement("div")
      state3.style.display = "flex"
      state3.style.justifyContent = "center"
      state3.style.alignItems = "center"
      state3.style.width = "55px"
      state3.style.height = "34px"
      state3.style.margin = "13px 0"
      state3.style.backgroundColor = "#11841e"
      button3.append(state3)

      state3.append(index3)

      navContainer.append(button3)



      const button4 = document.createElement("div")
      button4.classList.add("button-1")
      button4.style.display = "flex"
      button4.style.flexDirection = "column"
      button4.style.justifyContent = "center"
      button4.style.alignItems = "center"
      button4.style.width = "89px"
      button4.style.margin = "13px"
      button4.style.cursor = "pointer"
      button4.addEventListener("click", async() => await checkAndProceed("/felix/shs/abfrage-technisches/"))

      const title4 = document.createElement("div")
      title4.innerHTML = "Technisches"
      button4.append(title4)

      const index4 = document.createElement("div")
      index4.innerHTML = "4"
      index4.style.color = "white"

      const state4 = document.createElement("div")
      state4.style.display = "flex"
      state4.style.justifyContent = "center"
      state4.style.alignItems = "center"
      state4.style.width = "55px"
      state4.style.height = "34px"
      state4.style.margin = "13px 0"
      state4.style.backgroundColor = "#11841e"
      button4.append(state4)

      state4.append(index4)

      navContainer.append(button4)


      header.append(navContainer)

      let observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting === false) {
            navContainer.style.position = "fixed"
            navContainer.style.top = "0"
            navContainer.style.left = "0"
            navContainer.style.zIndex = "1"
            navContainer.style.backgroundColor = "white"
            navContainer.style.width = "100%"
          }

          if (entry.isIntersecting === true) {
            navContainer.style.position = "static"
          }

        })
      }, {threshold: 0})
      observer.observe(headerLogo)


      document.querySelectorAll(".technical-title").forEach(title => {
        title.innerHTML = "Technische Ausstattung"
        title.style.margin = "144px 34px 34px 34px"
        title.style.fontWeight = "normal"
      })


      const technischesWlan = new SelectionField("technischesWlan")
      .withLabel(label => label.innerHTML = "LAN Verbindung am Speicher vorhanden")
      .withOptions(["Ja", "Nein"])
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Eine LAN Verbindung ist eine kabelgebundene Verbindung, die das Energiesystem mit dem Internet verbindet. Diese Verbindung ist wichtig, da sie den Datenaustausch zwischen dem Energiesystem und anderen Geräten ermöglicht. Wenn keine LAN Verbindung am Speicherort vorhanden ist, müssen alternative Lösungen gefunden werden, um eine stabile und effiziente Verbindung zu gewährleisten."
          }
        })
      })
      .onInput(async() => {
        technischesWlan.withStorage(value => {
          funnel.value[technischesWlan.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesWlan.withStorage(value => {
        funnel.value[technischesWlan.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const technischesErdkabel = new SelectionField("technischesErdkabel")
      .withLabel(label => label.innerHTML = "Vorhandene Stromzuführung")
      .withOptions(["Erdkabel", "Freileitung"])
      .onInfoClick(() => {
        Helper.popupInfo({
          withImage: (img) => {
            img.src = "/felix/shs/public/freileitungunderdkabel.svg"
            img.alt = "Freileitung und Erdkabel"
            img.style.width = "100%"
            img.style.maxWidth = "344px"
          },
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Eine Freileitung ist eine Stromleitung, die über Masten und Strommasten läuft, während ein Erdkabel unter der Erde verlegt wird. Eine Freileitung kann anfälliger für Beschädigungen durch Wettereinflüsse oder Unfälle sein und eine höhere Wartung erfordern. Sie müssen sicherstellen, dass das Energiesystem so ausgelegt ist, dass es auch bei Stromausfällen oder anderen Unterbrechungen im Stromnetz stabil und effektiv arbeitet."
          }
        })
      })
      .onInput(async() => {
        technischesErdkabel.withStorage(value => {
          funnel.value[technischesErdkabel.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesErdkabel.withStorage(value => {
        funnel.value[technischesErdkabel.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const technischesPotentialAusgleich = new SelectionField("technischesPotentialAusgleich")
      .withLabel(label => label.innerHTML = "Potentialausgleichsschiene inkl. Fundamenterder vorhanden")
      .withOptions(["Ja", "Nein"])
      .onInfoClick(() => {
        Helper.popupInfo({
          withImage: (img) => {
            img.src = "/felix/shs/public/potentialausgleichschiene.svg"
            img.alt = "Potentialausgleichsschiene und Fundamenterder"
            img.style.width = "100%"
            img.style.maxWidth = "344px"
          },
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Eine Potentialausgleichsschiene ist eine elektrische Verbindung zwischen allen leitfähigen Teilen in einem Gebäude, die einen möglichen Unterschied in den elektrischen Potentialen ausgleichen soll. Der Fundamenterder ist ein tief im Boden verankertes metallisches Bauteil, das ebenfalls eine Verbindung zu den leitfähigen Teilen im Gebäude herstellt und so eine sichere Ableitung von Fehlströmen gewährleistet. Wenn die Potentialausgleichsschiene und der Fundamenterder nicht vorhanden oder nicht ausreichend dimensioniert sind, kann dies zu gefährlichen Fehlströmen führen. Dies kann nicht nur gefährlich sein, sondern auch das System beschädigen und den Betrieb beeinträchtigen."
          }
        })
      })
      .onInput(async() => {
        technischesPotentialAusgleich.withStorage(value => {
          funnel.value[technischesPotentialAusgleich.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesPotentialAusgleich.withStorage(value => {
        funnel.value[technischesPotentialAusgleich.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const technischesHakBild = new FileField("technischesHakBild")
      .withLabel(label => label.innerHTML = "Hausanschlusskasten")
      .withType(file => {
        file.accept = "image/jpeg, image/png"
        file.required = true
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withImage: (img) => {
            img.src = "/felix/shs/public/hausanschlusskasten.svg"
            img.alt = "Hausanschlusskasten"
            img.style.width = "100%"
            img.style.maxWidth = "344px"
          },
        })
      })
      .onInput(() => {
        technischesHakBild.withStorage(async value => {

          let array = []
          const allowedMimeTypes = ["image/jpeg", "image/png"]
          const allowedExtensions = ["jpg", "jpeg", "png"]
          for (let i = 0; i < value.length; i++) {


            await Helper.verifyFileMimeTypes(value[i], allowedMimeTypes)
            .catch(error => {
              alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
              Helper.setNotValidStyle(document.querySelector(technischesHakBild.inputSelector))
              throw error
            })

            await Helper.verifyFileExtension(value[i], allowedExtensions)
            .catch(error => {
              alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
              Helper.setNotValidStyle(document.querySelector(technischesHakBild.inputSelector))
              throw error
            })

            const dataUrl = await Helper.convertImageFileToDataUrl(value[i])
            const dataUrlSize = Helper.calculateDataUrlSize(dataUrl)
            if (dataUrlSize > 1024 * 1024) {
              alert("Bild ist zu groß.")
              Helper.setNotValidStyle(document.querySelector(technischesHakBild.inputSelector))
              throw new Error("image too large")
            }

            array.push({
              name: value[i].name,
              type: value[i].type,
              size: dataUrlSize,
              lastModified: Date.now(),
              dataUrl: dataUrl,
            })

          }

          if (array.length > 0) {
            funnel.value[technischesHakBild.name] = array
            window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
          }

        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesHakBild.withStorage(async value => {


        let array = []
        const allowedMimeTypes = ["image/jpeg", "image/png"]
        const allowedExtensions = ["jpg", "jpeg", "png"]
        for (let i = 0; i < value.length; i++) {


          await Helper.verifyFileMimeTypes(value[i], allowedMimeTypes)
          .catch(error => {
            alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
            Helper.setNotValidStyle(document.querySelector(technischesHakBild.inputSelector))
            throw error
          })

          await Helper.verifyFileExtension(value[i], allowedExtensions)
          .catch(error => {
            alert(`Erlaubte Bildformate: ${allowedExtensions.join(", ")}`)
            Helper.setNotValidStyle(document.querySelector(technischesHakBild.inputSelector))
            throw error
          })

          const dataUrl = await Helper.convertImageFileToDataUrl(value[i])
          const dataUrlSize = Helper.calculateDataUrlSize(dataUrl)
          if (dataUrlSize > 1024 * 1024) {
            alert("Bild ist zu groß.")
            Helper.setNotValidStyle(document.querySelector(technischesHakBild.inputSelector))
            throw new Error("image too large")
          }

          array.push({
            name: value[i].name,
            type: value[i].type,
            size: dataUrlSize,
            lastModified: Date.now(),
            dataUrl: dataUrl,
          })

        }

        if (array.length > 0) {
          funnel.value[technischesHakBild.name] = array
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        }

      })


      const technischesAnzahlHaks = new SelectionField("technischesAnzahlHaks")
      .withLabel(label => label.innerHTML = "Wieviele HAKs haben Sie")
      .withOptions(["1", "0", "2", "mehr als 2"])
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Ein Hausanschlusskasten ist ein wichtiger Bestandteil des Stromnetzes in einem Gebäude. Er dient als Verteiler für den Strom, der von außen über das Stromnetz ins Haus kommt, und leitet ihn zu den einzelnen Verbrauchern im Gebäude weiter. Wenn mehrere Hausanschlusskästen vorhanden sind, bedeutet dies, dass das Gebäude möglicherweise in mehrere Stromkreise unterteilt ist. Dies kann die Installation von Energiesystemen wie Photovoltaik mit Speicher, Wärmepumpen und Solarthermie beeinträchtigen. Jeder Stromkreis muss separat betrachtet werden, um sicherzustellen, dass das Energiesystem ordnungsgemäß installiert werden kann und keine Probleme verursacht."
          }
        })
      })
      .onInput(async() => {
        technischesAnzahlHaks.withStorage(value => {
          funnel.value[technischesAnzahlHaks.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesAnzahlHaks.withStorage(value => {
        funnel.value[technischesAnzahlHaks.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const technischesHakStandort = new SelectionField("technischesHakStandort")
      .withLabel(label => label.innerHTML = "Standort des Hausanschlusses")
      .withOptions(["Keller", "Erdgeschoss", "Obergeschoss", "Dachgeschoss", "Treppenhaus", "Andere"])
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Wenn man ein Energiesystem wie Photovoltaik mit Speicher, Wärmepumpen und Solarthermie in einem Gebäude installiert, muss man in der Lage sein, es an den Stromkreis anzuschließen, der den Hausanschlusskasten speist. Aus diesem Grund ist es wichtig zu wissen, wo sich der Hausanschlusskasten im Gebäude befindet und welche Verbraucher an ihn angeschlossen sind. Darüber hinaus kann die Position des Hausanschlusskastens auch Auswirkungen auf die Installation des Energiesystems haben. Wenn sich der Hausanschlusskasten beispielsweise in einem Bereich befindet, der schwer zugänglich ist oder sich in einem ungünstigen Bereich befindet, kann dies die Installation des Energiesystems erschweren."
          }
        })
      })
      .onInput(async() => {
        technischesHakStandort.withStorage(value => {
          funnel.value[technischesHakStandort.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesHakStandort.withStorage(value => {
        funnel.value[technischesHakStandort.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const technischesHakFrei = new CheckboxField("technischesHakFrei")
      .withLabel(label => label.innerHTML = "Der HAK ist frei zugänglich bzw. Baufreiheit gegeben")
      .withAfterCheckbox(after => after.innerHTML = "Ja, HAK ist frei zugänglich.")
      .withType(checkbox => checkbox.required = true)
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Zum Beispiel: Kein Kleiderschrank davor. Falls verschlossen: HAK muss am Montagetag geöffnet sein."
          }
        })
      })
      .onInput(async() => {
        technischesHakFrei.withStorage(value => {
          funnel.value[technischesHakFrei.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesHakFrei.withStorage(value => {
        funnel.value[technischesHakFrei.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const technischesZusatzInfo = new TextAreaField("technischesZusatzInfo")
      .withLabel(label => label.innerHTML = "Zusatzinformationen")
      .withType(textarea => {
        textarea.style.height = "144px"
        textarea.placeholder = "Ich habe einen Wintergarten, der bei der Montage abgedeckt werden soll.."
      })
      .onInput(async() => {
        technischesZusatzInfo.withStorage(value => {
          funnel.value[technischesZusatzInfo.name] = value
          window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesZusatzInfo.withStorage(value => {
        funnel.value[technischesZusatzInfo.name] = value
        window.localStorage.setItem("shsFunnel", JSON.stringify(funnel))
      })


      const speichernundweiterbutton = new DivField("save-and-proceed-button")
      .withType(div => {
        div.innerHTML = "Speichern und weiter"
        div.style.fontSize = "21px"
        div.style.margin = "144px 34px"
        div.style.backgroundColor = "#f7aa20"
        div.style.borderRadius = "13px"
        div.style.height = "89px"
        div.style.display = "flex"
        div.style.justifyContent = "center"
        div.style.alignItems = "center"
        div.addEventListener("mouseover", () => div.style.backgroundColor = "#f19d08")
        div.addEventListener("mouseout", () => div.style.backgroundColor = "#f7aa20")
      })
      .onClick(async () => await checkAndProceed("/felix/shs/hersteller-vergleich/"))


      Helper.createSHSFooter()


      const fields = [
        technischesWlan,
        technischesErdkabel,
        technischesPotentialAusgleich,
        technischesHakBild,
        technischesAnzahlHaks,
        technischesHakStandort,
        technischesHakFrei,
        technischesZusatzInfo,
      ]



      async function checkAndProceed(path) {
        for (let i = 0; i < fields.length; i++) {
          await fields[i].withValidValue()
        }

        window.location.assign(path)
      }


    </script>

  </body>
</html>
