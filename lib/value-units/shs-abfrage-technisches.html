<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <title>SHS Funnel</title>


    <style>
      body {
        margin: 0;
        line-height: 1.2;
        font-family: sans-serif;
      }
    </style>


  </head>
  <body>


    <header></header>

    <h1 class="technical-title"></h1>
    <div class="technical-funnel"></div>

    <div class="save-and-proceed-button"></div>

    <footer></footer>


    <script type="module">
      import { HeaderField } from "../../../../js/HeaderField.js"
      import { FunnelField } from "../../../../js/FunnelField.js"
      import { CheckboxField } from "../../../../js/CheckboxField.js"
      import { DivField } from "../../../../js/DivField.js"
      import { FileField } from "../../../../js/FileField.js"
      import { Helper } from "../../../../js/Helper.js"
      import { NumberField } from "../../../../js/NumberField.js"
      import { SelectionField } from "../../../../js/SelectionField.js"


      const funnel = Helper.getFunnelByStorageName("shsFunnel")
      // if (funnel === undefined) {
      //   window.location.assign("/felix/shs/funnel/qualifizierung/")
      //   throw new Error("funnel not found")
      // }

      const headerField = new HeaderField()
      .withImage(img => {
        img.src = "../../public/shslogo.png"
        img.alt = "SHS Express Logo"
        img.style.cursor = "pointer"
        img.style.width = "144px"
        img.addEventListener("click", async() => await Helper.redirectOperatorToChecklist())
      })
      .withType(header => {
        header.style.position = "fixed"
        header.style.top = "0"
        header.style.left = "0"
        header.style.zIndex = "1"
        header.style.backgroundColor = "white"
      })
      .withNavigation([
        {active: true, name: "Haus", onclick: async() => await checkAndProceed(funnel.path.house)},
        {active: true, name: "Heizung", onclick: async() => await checkAndProceed(funnel.path.heating)},
        {active: true, name: "Strom", onclick: async() => await checkAndProceed(funnel.path.electricity)},
        {active: true, name: "Technisches", onclick: async() => await checkAndProceed(funnel.path.technical)}
      ])
      .build()

      document.querySelectorAll(".technical-title").forEach(title => {
        title.innerHTML = "Technische Ausstattung"
        title.style.margin = "377px 34px 34px 34px"
        title.style.fontWeight = "normal"
      })


      const technicalFunnel = new FunnelField("technical-funnel")
      .withFields([
        {class: "technischesWlan", type: "select", withLabel: "LAN Verbindung am Speicher vorhanden", withOptions: ["Ja", "Nein"]},
        {class: "technischesErdkabel", type: "select", withLabel: "Vorhandene Stromzuführung", withOptions: ["Erdkabel", "Freileitung"]},
        {class: "technischesPotentialAusgleich", type: "select", withLabel: "Potentialausgleichsschiene inkl. Fundamenterder vorhanden", withOptions: ["Ja", "Nein"]},
        {class: "technischesHakBild", type: "file", withLabel: label => label.innerHTML = "Hausanschlusskasten", withType: hakBildOption},
        {class: "technischesAnzahlHaks", type: "select", withLabel: "Wieviele HAKs haben Sie", withOptions: ["1", "0", "2", "mehr als 2"]},
        {class: "technischesHakStandort", type: "select", withLabel: "Standort des Hausanschlusses", withOptions: ["Keller", "Erdgeschoss", "Obergeschoss", "Dachgeschoss", "Treppenhaus", "Andere"]},
        {class: "technischesHakFrei", type: "checkbox", withLabel: "Der HAK ist frei zugänglich bzw. Baufreiheit gegeben z.B. kein Kleiderschrank davor falls verschlossen: HAK muss am Montagetag geöffnet sein", afterCheckbox: "Ja, HAK ist frei zugänglich.", withType: (box) => box.required = true},
        {class: "technischesZusatzInfo", type: "textarea", withLabel: "Zusatzinformationen", withType: zusatzInfoOption},
      ])

      function hakBildOption(input) {
        input.accept = "image/*"
        input.required = true
      }

      function zusatzInfoOption(input) {
        input.placeholder = "Ich habe einen Wintergarten, der bei der Montage abgedeckt werden soll.."
      }

      technicalFunnel.withStorage(funnel.storage).buildFields()

      const speichernundweiterbutton = new DivField("save-and-proceed-button")
      .withType(div => {
        div.innerHTML = "Speichern und weiter"
        div.style.fontSize = "21px"
        div.style.margin = "144px 34px"
        div.style.backgroundColor = "#f7aa20"
        div.style.borderRadius = "13px"
        div.style.height = "89px"
        div.style.display = "flex"
        div.style.justifyContent = "center"
        div.style.alignItems = "center"
        div.addEventListener("mouseover", () => div.style.backgroundColor = "#f19d08")
        div.addEventListener("mouseout", () => div.style.backgroundColor = "#f7aa20")
      })
      .onClick(async () => await checkAndProceed("/felix/shs/match-maker/hersteller-vergleich/"))


      Helper.createSHSFooter()

      async function checkAndProceed(path) {
        await technicalFunnel.checkValidity()

        window.location.assign(path)
      }


    </script>

  </body>
</html>
