<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="shortcut icon" href="/public/getyour-logo.svg" />
    <title>SHS Funnel Abfrage Technisches</title>


    <style>
      body {
        margin: 0;
        line-height: 1.2;
        font-family: sans-serif;
      }
    </style>


  </head>
  <body>


    <header></header>

    <h1 class="technical-title"></h1>
    <div class="technischesWlan"></div>
    <div class="technischesErdkabel"></div>
    <div class="technischesPotentialAusgleich"></div>
    <div class="technischesHakBild"></div>
    <div class="technischesAnzahlHaks"></div>
    <div class="technischesHakStandort"></div>
    <div class="technischesHakFrei"></div>
    <div class="technischesZusatzInfo"></div>


    <div class="save-and-proceed-button"></div>

    <footer></footer>


    <script type="module">
      import { HeaderField } from "/js/HeaderField.js"
      import { CheckboxField } from "/js/CheckboxField.js"
      import { DivField } from "/js/DivField.js"
      import { FileField } from "/js/FileField.js"
      import { Helper } from "/js/Helper.js"
      import { SelectionField } from "/js/SelectionField.js"
      import { TextAreaField } from "/js/TextAreaField.js"
      import { Request } from "/js/Request.js"


      const funnel = Helper.findFunnel(funnel => funnel.owner.id === Request.localStorageId())
      if (funnel === undefined) {
        window.location.assign("/felix/shs/funnel/qualifizierung/")
        throw new Error("funnel not found")
      }


      const headerField = new HeaderField()
      .withImage(img => {
        img.src = "/felix/shs/public/shslogo.png"
        img.alt = "SHS Express Logo"
        img.style.cursor = "pointer"
        img.style.width = "144px"
        img.addEventListener("click", async() => await Helper.redirectUser())
      })
      .withType(header => {
        header.style.position = "fixed"
        header.style.top = "0"
        header.style.left = "0"
        header.style.zIndex = "1"
        header.style.width = "100%"
        header.style.backgroundColor = "white"
      })
      .withNavigation([
        {active: true, name: "Haus", onclick: async() => await checkAndProceed(funnel.path.house)},
        {active: true, name: "Heizung", onclick: async() => await checkAndProceed(funnel.path.heating)},
        {active: true, name: "Strom", onclick: async() => await checkAndProceed(funnel.path.electricity)},
        {active: true, name: "Technisches", onclick: async() => await checkAndProceed(funnel.path.technical)}
      ])
      .build()

      document.querySelectorAll(".technical-title").forEach(title => {
        title.innerHTML = "Technische Ausstattung"
        title.style.margin = "377px 34px 34px 34px"
        title.style.fontWeight = "normal"
      })


      const technischesWlan = new SelectionField("technischesWlan")
      .withLabel(label => label.innerHTML = "LAN Verbindung am Speicher vorhanden")
      .withOptions(["Ja", "Nein"])
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Eine LAN Verbindung ist eine kabelgebundene Verbindung, die das Energiesystem mit dem Internet verbindet. Diese Verbindung ist wichtig, da sie den Datenaustausch zwischen dem Energiesystem und anderen Geräten ermöglicht. Wenn keine LAN Verbindung am Speicherort vorhanden ist, müssen alternative Lösungen gefunden werden, um eine stabile und effiziente Verbindung zu gewährleisten."
          }
        })
      })
      .onInput(async() => {
        technischesWlan.withStorage(value => {
          funnel.value[technischesWlan.name] = value
          Helper.setFunnel(funnel)
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesWlan.withStorage(value => {
        funnel.value[technischesWlan.name] = value
        Helper.setFunnel(funnel)
      })


      const technischesErdkabel = new SelectionField("technischesErdkabel")
      .withLabel(label => label.innerHTML = "Vorhandene Stromzuführung")
      .withOptions(["Erdkabel", "Freileitung"])
      .onInfoClick(() => {
        Helper.popupInfo({
          withImage: (img) => {
            img.src = "/felix/shs/public/freileitungunderdkabel.svg"
            img.alt = "Freileitung und Erdkabel"
            img.style.width = "100%"
            img.style.maxWidth = "344px"
          },
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Eine Freileitung ist eine Stromleitung, die über Masten und Strommasten läuft, während ein Erdkabel unter der Erde verlegt wird. Eine Freileitung kann anfälliger für Beschädigungen durch Wettereinflüsse oder Unfälle sein und eine höhere Wartung erfordern. Sie müssen sicherstellen, dass das Energiesystem so ausgelegt ist, dass es auch bei Stromausfällen oder anderen Unterbrechungen im Stromnetz stabil und effektiv arbeitet."
          }
        })
      })
      .onInput(async() => {
        technischesErdkabel.withStorage(value => {
          funnel.value[technischesErdkabel.name] = value
          Helper.setFunnel(funnel)
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesErdkabel.withStorage(value => {
        funnel.value[technischesErdkabel.name] = value
        Helper.setFunnel(funnel)
      })


      const technischesPotentialAusgleich = new SelectionField("technischesPotentialAusgleich")
      .withLabel(label => label.innerHTML = "Potentialausgleichsschiene inkl. Fundamenterder vorhanden")
      .withOptions(["Ja", "Nein"])
      .onInfoClick(() => {
        Helper.popupInfo({
          withImage: (img) => {
            img.src = "/felix/shs/public/potentialausgleichschiene.svg"
            img.alt = "Potentialausgleichsschiene und Fundamenterder"
            img.style.width = "100%"
            img.style.maxWidth = "344px"
          },
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Eine Potentialausgleichsschiene ist eine elektrische Verbindung zwischen allen leitfähigen Teilen in einem Gebäude, die einen möglichen Unterschied in den elektrischen Potentialen ausgleichen soll. Der Fundamenterder ist ein tief im Boden verankertes metallisches Bauteil, das ebenfalls eine Verbindung zu den leitfähigen Teilen im Gebäude herstellt und so eine sichere Ableitung von Fehlströmen gewährleistet. Wenn die Potentialausgleichsschiene und der Fundamenterder nicht vorhanden oder nicht ausreichend dimensioniert sind, kann dies zu gefährlichen Fehlströmen führen. Dies kann nicht nur gefährlich sein, sondern auch das System beschädigen und den Betrieb beeinträchtigen."
          }
        })
      })
      .onInput(async() => {
        technischesPotentialAusgleich.withStorage(value => {
          funnel.value[technischesPotentialAusgleich.name] = value
          Helper.setFunnel(funnel)
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesPotentialAusgleich.withStorage(value => {
        funnel.value[technischesPotentialAusgleich.name] = value
        Helper.setFunnel(funnel)
      })


      const technischesHakBild = new FileField("technischesHakBild")
      .withLabel(label => label.innerHTML = "Hausanschlusskasten")
      .withType(file => {
        file.accept = "image/*"
        file.required = true
      })
      .onInfoClick(() => {
        Helper.popupInfo({
          withImage: (img) => {
            img.src = "/felix/shs/public/hausanschlusskasten.svg"
            img.alt = "Hausanschlusskasten"
            img.style.width = "100%"
            img.style.maxWidth = "344px"
          },
        })
      })
      .onInput(async() => {
        technischesHakBild.withStorage(value => {
          funnel.value[technischesHakBild.name] = value
          Helper.setFunnel(funnel)
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesHakBild.withStorage(value => {
        funnel.value[technischesHakBild.name] = value
        Helper.setFunnel(funnel)
      })


      const technischesAnzahlHaks = new SelectionField("technischesAnzahlHaks")
      .withLabel(label => label.innerHTML = "Wieviele HAKs haben Sie")
      .withOptions(["1", "0", "2", "mehr als 2"])
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Ein Hausanschlusskasten ist ein wichtiger Bestandteil des Stromnetzes in einem Gebäude. Er dient als Verteiler für den Strom, der von außen über das Stromnetz ins Haus kommt, und leitet ihn zu den einzelnen Verbrauchern im Gebäude weiter. Wenn mehrere Hausanschlusskästen vorhanden sind, bedeutet dies, dass das Gebäude möglicherweise in mehrere Stromkreise unterteilt ist. Dies kann die Installation von Energiesystemen wie Photovoltaik mit Speicher, Wärmepumpen und Solarthermie beeinträchtigen. Jeder Stromkreis muss separat betrachtet werden, um sicherzustellen, dass das Energiesystem ordnungsgemäß installiert werden kann und keine Probleme verursacht."
          }
        })
      })
      .onInput(async() => {
        technischesAnzahlHaks.withStorage(value => {
          funnel.value[technischesAnzahlHaks.name] = value
          Helper.setFunnel(funnel)
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesAnzahlHaks.withStorage(value => {
        funnel.value[technischesAnzahlHaks.name] = value
        Helper.setFunnel(funnel)
      })


      const technischesHakStandort = new SelectionField("technischesHakStandort")
      .withLabel(label => label.innerHTML = "Standort des Hausanschlusses")
      .withOptions(["Keller", "Erdgeschoss", "Obergeschoss", "Dachgeschoss", "Treppenhaus", "Andere"])
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Wenn man ein Energiesystem wie Photovoltaik mit Speicher, Wärmepumpen und Solarthermie in einem Gebäude installiert, muss man in der Lage sein, es an den Stromkreis anzuschließen, der den Hausanschlusskasten speist. Aus diesem Grund ist es wichtig zu wissen, wo sich der Hausanschlusskasten im Gebäude befindet und welche Verbraucher an ihn angeschlossen sind. Darüber hinaus kann die Position des Hausanschlusskastens auch Auswirkungen auf die Installation des Energiesystems haben. Wenn sich der Hausanschlusskasten beispielsweise in einem Bereich befindet, der schwer zugänglich ist oder sich in einem ungünstigen Bereich befindet, kann dies die Installation des Energiesystems erschweren."
          }
        })
      })
      .onInput(async() => {
        technischesHakStandort.withStorage(value => {
          funnel.value[technischesHakStandort.name] = value
          Helper.setFunnel(funnel)
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesHakStandort.withStorage(value => {
        funnel.value[technischesHakStandort.name] = value
        Helper.setFunnel(funnel)
      })


      const technischesHakFrei = new CheckboxField("technischesHakFrei")
      .withLabel(label => label.innerHTML = "Der HAK ist frei zugänglich bzw. Baufreiheit gegeben")
      .withAfterCheckbox(after => after.innerHTML = "Ja, HAK ist frei zugänglich.")
      .withType(checkbox => checkbox.required = true)
      .onInfoClick(() => {
        Helper.popupInfo({
          withText: (p) => {
            p.style.fontSize = "21px"
            p.style.lineHeight = "1.4"
            p.innerHTML = "Zum Beispiel: Kein Kleiderschrank davor. Falls verschlossen: HAK muss am Montagetag geöffnet sein."
          }
        })
      })
      .onInput(async() => {
        technischesHakFrei.withStorage(value => {
          funnel.value[technischesHakFrei.name] = value
          Helper.setFunnel(funnel)
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesHakFrei.withStorage(value => {
        funnel.value[technischesHakFrei.name] = value
        Helper.setFunnel(funnel)
      })


      const technischesZusatzInfo = new TextAreaField("technischesZusatzInfo")
      .withLabel(label => label.innerHTML = "Zusatzinformationen")
      .withType(textarea => textarea.placeholder = "Ich habe einen Wintergarten, der bei der Montage abgedeckt werden soll..")
      .onInput(async() => {
        technischesZusatzInfo.withStorage(value => {
          funnel.value[technischesZusatzInfo.name] = value
          Helper.setFunnel(funnel)
        })
      })
      .fromStorage((name) => funnel.value[name])
      technischesZusatzInfo.withStorage(value => {
        funnel.value[technischesZusatzInfo.name] = value
        Helper.setFunnel(funnel)
      })


      const speichernundweiterbutton = new DivField("save-and-proceed-button")
      .withType(div => {
        div.innerHTML = "Speichern und weiter"
        div.style.fontSize = "21px"
        div.style.margin = "144px 34px"
        div.style.backgroundColor = "#f7aa20"
        div.style.borderRadius = "13px"
        div.style.height = "89px"
        div.style.display = "flex"
        div.style.justifyContent = "center"
        div.style.alignItems = "center"
        div.addEventListener("mouseover", () => div.style.backgroundColor = "#f19d08")
        div.addEventListener("mouseout", () => div.style.backgroundColor = "#f7aa20")
      })
      .onClick(async () => await checkAndProceed("/felix/shs/match-maker/hersteller-vergleich/"))


      Helper.createSHSFooter()


      const fields = [
        technischesWlan,
        technischesErdkabel,
        technischesPotentialAusgleich,
        technischesHakBild,
        technischesAnzahlHaks,
        technischesHakStandort,
        technischesHakFrei,
        technischesZusatzInfo,
      ]



      async function checkAndProceed(path) {
        for (let i = 0; i < fields.length; i++) {
          await fields[i].withValidValue()
        }

        window.location.assign(path)
      }


    </script>

  </body>
</html>
