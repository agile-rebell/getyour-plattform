<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="shortcut icon" href="/public/getyour-logo.svg" />
    <title>SHS Experten kontaktieren</title>



    <style>
      body {
        margin: 0;
        line-height: 1.2;
        font-family: sans-serif;
      }
    </style>


  </head>
  <body>
    <header></header>

    <div class="title"></div>

    <div class="lead-info"></div>


    <div class="contactType"></div>
    <div class="phone"></div>
    <div class="date"></div>


    <div class="lead-button"></div>


    <footer></footer>

  <script type="module">

    import {Request} from "/js/Request.js"
    import {DivField} from "/js/DivField.js"
    import {HeaderField} from "/js/HeaderField.js"
    import {Helper} from "/js/Helper.js"
    import {InfoField} from "/js/InfoField.js"
    import {SelectionField} from "/js/SelectionField.js"
    import {TelField} from "/js/TelField.js"
    import {DateField} from "/js/DateField.js"

    const localStorageId = await Request.localStorageId()


    const header = new HeaderField()
    .withImage(img => {
      img.src = "/felix/shs/public/shslogo.png"
      img.alt = "SHS Express Logo"
      img.style.cursor = "pointer"
      img.style.width = "144px"
      img.addEventListener("click", () => window.history.back())
    })
    .withType(header => {
      header.style.position = "fixed"
      header.style.top = "0"
      header.style.left = "0"
      header.style.zIndex = "1"
      header.style.backgroundColor = "white"
      header.style.width = "100%"
    })
    .build()


    const title = new DivField("title")
    .withType(div => {
      const title = document.createElement("h1")
      title.style.margin = "144px 34px 34px 34px"
      title.style.fontWeight = "normal"
      title.innerHTML = "Kontakt anfordern"
      div.append(title)
    })

    const leadInfo = new InfoField("lead-info")
    .withSuccess(/*html*/`
      <p>Offene Fragen?</p>
      <p>Kontaktieren Sie einen Fachexperten:</p>
    `)
    .withType(info => info.style.fontSize = "21px")
    .build()


    const contactTypeField = new SelectionField("contactType")
    .withLabel(label => label.innerHTML = "Kontaktaufnahme:")
    .withOptions(["Telefon", "E-Mail", "Webcall", "Persönlich"])
    .onInput((event) => {
      if (event.target.value !== "Telefon") {
        document.querySelectorAll(phoneField.inputSelector).forEach(input => {
          input.disabled = true
          input.required = false
          phoneField.withValidValue()
        })
      }
      if (event.target.value === "Telefon") {
        document.querySelectorAll(phoneField.inputSelector).forEach(input => {
          input.disabled = false
          input.required = true
          phoneField.withValidValue()
        })
      }
    })
    contactTypeField.withValidValue()

    const phoneField = new TelField("phone")
    .withLabel(label => label.innerHTML = "Telefonnummer:")
    .withType(tel => {
      tel.placeholder = "+491764321567"
      tel.required = true
      tel.pattern = "\\+49\\d{6,}"
    })
    .onInput(() => phoneField.withValidValue())
    phoneField.withValidValue()

    const dateField = new DateField("date")
    .withLabel(label => label.innerHTML = "Datum auswählen:")
    .withType(date => {
      date.pattern = "[0-9]{4}-[0-9]{2}-[0-9]{2}"
      date.min = new Date().toISOString().split("T")[0]
      date.value = date.min
    })
    dateField.withValidValue()


    const leadButton = new DivField("lead-button")
    .withType(div => {
      div.innerHTML = "Kontakt anfordern"
      div.style.margin = "34px"
      div.style.height = "55px"
      div.style.backgroundColor = "rgb(247, 170, 32)"
      div.style.borderRadius = "13px"
      div.style.display = "flex"
      div.style.justifyContent = "center"
      div.style.alignItems = "center"
      div.style.fontSize = "21px"
      div.style.cursor = "pointer"
      div.addEventListener("mouseover", () => div.style.backgroundColor = "rgb(237, 160, 22)")
      div.addEventListener("mouseout", () => div.style.backgroundColor = "rgb(247, 170, 32)")

      div.addEventListener("click", async() => {

        const contactType = await contactTypeField.withValidValue()
        const phone = await phoneField.withValidValue()
        const date = await dateField.withValidValue()

        Helper.addOverlay()
        Helper.setWaitCursor()
        try {
          const registerLead = {}
          registerLead.url = "/consumer/1/closed/"
          registerLead.consumer = "operator"
          registerLead.method = "register"
          registerLead.type = "lead"
          registerLead.security = "open"
          registerLead.contactType = contactType[0].value
          registerLead.phone = phone
          registerLead.date = date
          registerLead.email = await Request.email()
          registerLead.referer = document.referrer
          registerLead.localStorageId = await Request.localStorageId()
          const res = await Request.middleware(registerLead)

          if (res.status !== 200) return window.location.assign("/home/")
          alert("Ihre Anfrage wurde erfolgreich weitergeleitet.\n\nSobald Ihr neuer persönlicher Ansprechpartner Ihren Terminvorschlag bestätigt, erhalten Sie eine Benachrichtigung per E-Mail.")
          if (res.status === 200) return window.location.assign("/felix/shs/")
        } catch (error) {
          window.location.assign("/home/")
        }
      })
    })

    Helper.createSHSFooter()

  </script>
</body>


</html>
