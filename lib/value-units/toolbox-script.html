<script id="toolbox" type="module">

  import {Request} from "/js/Request.js"
  import {Helper} from "/js/Helper.js"
  import {FileField} from "/js/FileField.js"
  import {TextField} from "/js/TextField.js"
  import {SelectionField} from "/js/SelectionField.js"
  import {TextAreaField} from "/js/TextAreaField.js"


  // Templates for each element
  // html import should allow innerhtml in the element it is called
  // html import for each
  // html js manipulation for each element


  const localStoragId = window.localStorage.getItem("localStorageId")
  if (localStoragId !== null) {
    const localStorageEmail = window.localStorage.getItem("email")
    if (localStorageEmail !== null) {

      {
        const verify = {}
        verify.url = "/verify/expert/closed/3/"
        verify.event = "toolbox"
        verify.localStorageId = await Request.localStorageId()
        verify.localStorageEmail = await Request.email()
        verify.location = window.location.href
        verify.referer = document.referrer
        const res = await Request.middleware(verify)

        if (res.status === 200) {

          {
            const toolbox = Helper.iconPicker("getyour")
            toolbox.setAttribute("data-id", "toolbox")
            toolbox.style.position = "fixed"
            toolbox.style.bottom = "0"
            toolbox.style.right = "0"

            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              toolbox.style.boxShadow = "0 3px 5px rgba(255, 255, 255, 0.13)"
              toolbox.style.border = `0.3px solid ${Helper.colors.matte.dark.accent}`
              toolbox.style.backgroundColor = Helper.colors.matte.dark.background
            } else {
              toolbox.style.boxShadow = "0 3px 5px rgba(0, 0, 0, 0.13)"
              toolbox.style.border = `0.3px solid ${Helper.colors.matte.light.accent}`
              toolbox.style.backgroundColor = Helper.colors.matte.light.background
            }

            toolbox.style.width = "34px"
            toolbox.style.height = "34px"
            toolbox.style.borderRadius = "50%"
            toolbox.style.margin = "21px 34px"
            toolbox.style.padding = "21px"
            toolbox.style.zIndex = "1"
            toolbox.style.cursor = "pointer"
            document.body.insertBefore(toolbox, document.querySelector("#toolbox"))

            toolbox.addEventListener("click", () => {

              Helper.popup(async overlay => {
                overlay.classList.add("overlay-1")
                const overlay1 = overlay

                {
                  const show = document.createElement("img")
                  show.src = "/public/show.svg"
                  show.alt = "Vorschau"
                  show.style.position = "absolute"
                  show.style.left = "0"
                  show.style.bottom = "0"
                  show.style.width = "55px"
                  show.style.padding = "13px"
                  show.style.margin = "21px 34px"
                  show.style.border = "0.3px solid black"
                  show.style.borderRadius = "50%"
                  show.style.backgroundColor = "#fff"
                  show.style.boxShadow = "0px 5px 8px rgba(0, 0, 0, 0.21)"
                  show.style.zIndex = "999"
                  show.style.cursor = "pointer"
                  show.addEventListener("click", () => Helper.removeOverlay(overlay))
                  overlay.append(show)

                  const save = document.createElement("img")
                  save.src = "/public/save.svg"
                  save.alt = "Speichern"
                  save.style.position = "absolute"
                  save.style.right = "0"
                  save.style.bottom = "0"
                  save.style.width = "55px"
                  save.style.padding = "13px"
                  save.style.margin = "21px 34px"
                  save.style.border = "0.3px solid black"
                  save.style.backgroundColor = "#fff"
                  save.style.borderRadius = "50%"
                  save.style.boxShadow = "0px 5px 8px rgba(0, 0, 0, 0.21)"
                  save.style.zIndex = "999"
                  save.style.cursor = "pointer"
                  save.addEventListener("click", async () => {

                    const toolboxScript = document.getElementById("toolbox")
                    const dataIds = document.querySelectorAll("[data-id]")
                    try {

                      dataIds.forEach(element => element.remove())
                      toolboxScript.remove()
                      overlay.remove()
                      // document.body.removeAttribute("style")
                      document.body.style.overscrollBehavior = null
                      document.body.style.overflow = null

                      const register = {}
                      register.url = "/register/platform-value/closed/3/"
                      register.type = "html"
                      register.html = document.documentElement.outerHTML.replace(/<html>/, "<!DOCTYPE html><html>")
                      register.localStorageId = await Request.localStorageId()
                      register.localStorageEmail = await Request.email()
                      register.location = window.location.href
                      register.referer = document.referrer
                      await Request.sequence(register)

                      window.location.reload()
                    } catch (error) {
                      for (let i = 0; i < dataIds.length; i++) {
                        const dataId = dataIds[i]
                        document.body.insertBefore(dataId, document.querySelector(`script[id='${dataId.getAttribute("data-id")}']`))
                      }
                      alert("Fehler.. Bitte wiederholen.")
                    }

                  })
                  overlay.append(save)

                }


                const buttons = document.createElement("div")
                buttons.style.overflow = "auto"
                buttons.style.overscrollBehavior = "none"
                buttons.style.paddingBottom = "144px"
                overlay.append(buttons)

                {
                  const verify = {}
                  verify.url = "/verify/role/closed/2/"
                  verify.localStorageId = await Request.localStorageId()
                  verify.localStorageEmail = await Request.email()
                  verify.location = window.location.href
                  verify.referer = document.referrer
                  const res = await Request.middleware(verify)

                  if (res.status === 200) {
                    const button = document.createElement("div")
                    button.style.display = "flex"
                    button.style.flexWrap = "wrap"
                    button.style.justifyContent = "space-between"
                    button.style.alignItems = "center"
                    button.style.margin = "21px 34px"
                    button.style.backgroundColor = "rgba(255, 255, 255, 0.6)"
                    button.style.borderRadius = "13px"
                    button.style.border = "0.3px solid black"
                    button.style.boxShadow = "0 3px 6px rgba(0, 0, 0, 0.16)"
                    button.style.cursor = "pointer"
                    button.addEventListener("click", () => {

                      Helper.popup(overlay => {
                        overlay.id = "overlay-3"
                        const overlay3 = overlay

                        Helper.headerPicker("removeOverlay", overlay)

                        {
                          const funnel = document.createElement("div")
                          funnel.style.overflow = "auto"
                          funnel.style.overscrollBehavior = "none"
                          funnel.style.paddingBottom = "144px"
                          overlay.append(funnel)

                          const htmlField = new TextAreaField("htm-l", funnel)
                          htmlField.label.innerHTML = "HTML Dokument"
                          htmlField.label.style.fontFamily = "sans-serif"
                          htmlField.input.style.fontSize = "13px"
                          htmlField.input.style.height = "89px"
                          htmlField.input.placeholder = `<html>..</html>`
                          htmlField.input.addEventListener("input", () => {
                            htmlField.verifyValue()
                          })

                          const button = document.createElement("div")
                          button.innerHTML = "Jetzt ersetzen"
                          button.style.backgroundColor = "#f7aa20"
                          button.style.cursor = "pointer"
                          button.style.fontSize = "21px"
                          button.style.fontFamily = "sans-serif"
                          button.style.borderRadius = "13px"
                          button.style.margin = "21px 34px"
                          button.style.display = "flex"
                          button.style.justifyContent = "center"
                          button.style.alignItems = "center"
                          button.style.height = "89px"
                          button.style.color = "#000"
                          button.style.boxShadow = "0 3px 6px rgba(0, 0, 0, 0.16)"
                          button.addEventListener("click", async () => {

                            const html = htmlField.validValue()

                            const confirm = window.confirm("Achtung! Diese Funktion wird dein aktuelles HTML Dokument mit deinem neuen HTML Import ersetzen. Der Inhalt deines aktuellen Dokuments wird unwideruflich gelöscht, sobald du deine Werteinheit abspeicherst.\n\n Möchtest du dein aktuelles HTML Dokument wirklich ersetzen?")
                            if (confirm === true) {

                              const toolbox = document.getElementById("toolbox").cloneNode(true)

                              document.open()
                              document.write(html)
                              document.close()

                              const script = document.createElement("script")
                              script.id = toolbox.id
                              script.type = toolbox.type
                              script.innerHTML = toolbox.innerHTML
                              document.body.append(script)

                            }

                            Helper.removeOverlay(overlay)

                          })
                          funnel.append(button)
                        }



                      })


                    })

                    const left = document.createElement("div")
                    left.innerHTML = "document.write()"
                    left.style.margin = "21px 34px"
                    left.style.fontSize = "21px"
                    left.style.fontFamily = "sans-serif"
                    button.append(left)

                    const title = document.createElement("div")
                    title.innerHTML = "Dokument ersetzen"
                    title.style.margin = "21px 34px"
                    title.style.fontSize = "13px"
                    title.style.fontFamily = "sans-serif"
                    button.append(title)

                    buttons.append(button)
                  }

                }

                {
                  const button = document.createElement("div")
                  button.style.display = "flex"
                  button.style.flexWrap = "wrap"
                  button.style.justifyContent = "space-between"
                  button.style.alignItems = "center"
                  button.style.margin = "21px 34px"
                  button.style.backgroundColor = "rgba(255, 255, 255, 0.6)"
                  button.style.borderRadius = "13px"
                  button.style.border = "0.3px solid black"
                  button.style.boxShadow = "0 3px 6px rgba(0, 0, 0, 0.16)"
                  button.style.cursor = "pointer"

                  button.addEventListener("click", async () => {

                    if (document.head.children.length > 0) {

                      Helper.popup(overlay => {

                        Helper.headerPicker("removeOverlay", overlay)
                        const elementInfo = Helper.headerPicker("elementInfo", overlay)
                        elementInfo.append(Helper.convert("element/alias", document.head))

                        const buttons = document.createElement("div")
                        buttons.style.overflowY = "auto"
                        buttons.style.paddingBottom = "144px"
                        buttons.style.overscrollBehavior = "none"
                        overlay.append(buttons)

                        {
                          const button = document.createElement("div")
                          button.style.display = "flex"
                          button.style.flexWrap = "wrap"
                          button.style.justifyContent = "space-between"
                          button.style.alignItems = "center"
                          button.style.margin = "21px 34px"
                          button.style.backgroundColor = "rgba(255, 255, 255, 0.6)"

                          button.style.borderRadius = "13px"
                          button.style.border = "0.3px solid black"
                          button.style.boxShadow = "0 3px 6px rgba(0, 0, 0, 0.16)"
                          button.style.cursor = "pointer"

                          button.addEventListener("click", async () => {

                            if (document.head.children.length > 0) {

                              Helper.popup(overlay => {


                                Helper.headerPicker("removeOverlay", overlay)
                                const elementInfo = Helper.headerPicker("elementInfo", overlay)

                                elementInfo.append(Helper.convert("element/alias", document.head))

                                const span = document.createElement("span")
                                span.innerHTML = ".children"
                                span.style.fontSize = "13px"
                                span.style.fontFamily = "monospace"
                                elementInfo.append(span)

                                Helper.renderChildren(document.head, overlay)

                              })

                            } else alert("Das HTML Element ist leer.")


                          })

                          const left = document.createElement("div")
                          left.innerHTML = ".children"
                          left.style.margin = "21px 34px"
                          left.style.fontSize = "21px"
                          left.style.fontFamily = "sans-serif"
                          button.append(left)

                          const title = document.createElement("div")
                          title.innerHTML = "Element Inhalt"
                          title.style.margin = "21px 34px"
                          title.style.fontSize = "13px"
                          title.style.fontFamily = "sans-serif"
                          button.append(title)

                          buttons.append(button)
                        }

                      })

                    } else alert("Das HTML Kopf ist leer.")


                  })

                  const left = document.createElement("div")
                  left.innerHTML = "document.head"
                  left.style.margin = "21px 34px"
                  left.style.fontSize = "21px"
                  left.style.fontFamily = "sans-serif"
                  button.append(left)

                  const title = document.createElement("div")
                  title.innerHTML = "Dokumentenkopf"
                  title.style.margin = "21px 34px"
                  title.style.fontSize = "13px"
                  title.style.fontFamily = "sans-serif"
                  button.append(title)

                  buttons.append(button)
                }

                {
                  const button = document.createElement("div")
                  button.style.display = "flex"
                  button.style.flexWrap = "wrap"
                  button.style.justifyContent = "space-between"
                  button.style.alignItems = "center"
                  button.style.margin = "21px 34px"
                  button.style.backgroundColor = "rgba(255, 255, 255, 0.6)"
                  button.style.borderRadius = "13px"
                  button.style.border = "0.3px solid black"
                  button.style.boxShadow = "0 3px 6px rgba(0, 0, 0, 0.16)"
                  button.style.cursor = "pointer"

                  button.addEventListener("click", async () => {

                    Helper.popup(overlay => {

                      overlay.classList.add("overlay-2")
                      const overlay2 = overlay

                      Helper.headerPicker("removeOverlay", overlay)
                      const elementInfo = Helper.headerPicker("elementInfo", overlay)

                      elementInfo.append(Helper.convert("element/alias", document.body))

                      const buttons = document.createElement("div")
                      buttons.style.overflowY = "auto"
                      buttons.style.paddingBottom = "144px"
                      buttons.style.overscrollBehavior = "none"
                      overlay.append(buttons)


                      {
                        // in body
                        // add templates
                        // tags the expert with templates = []
                        // shows a list of all expert.templates
                        // if visible
                        // in use?
                        // purchase to use?
                        // payment ?

                        const button = document.createElement("div")
                        button.style.display = "flex"
                        button.style.flexWrap = "wrap"
                        button.style.justifyContent = "space-between"
                        button.style.alignItems = "center"
                        button.style.margin = "21px 34px"
                        button.style.backgroundColor = "rgba(255, 255, 255, 0.6)"

                        button.style.borderRadius = "13px"
                        button.style.border = "0.3px solid black"
                        button.style.boxShadow = "0 3px 6px rgba(0, 0, 0, 0.16)"
                        button.style.cursor = "pointer"
                        button.addEventListener("click", () => {
                          alert("Bald verfügbar..")
                        })


                        const left = document.createElement("div")
                        left.innerHTML = ".templates"
                        left.style.margin = "21px 34px"
                        left.style.fontSize = "21px"
                        left.style.fontFamily = "sans-serif"
                        button.append(left)

                        const title = document.createElement("div")
                        title.innerHTML = "Template einsetzen"
                        title.style.margin = "21px 34px"
                        title.style.fontSize = "13px"
                        title.style.fontFamily = "sans-serif"
                        button.append(title)

                        buttons.append(button)
                      }

                      {
                        const button = document.createElement("div")
                        button.style.display = "flex"
                        button.style.flexWrap = "wrap"
                        button.style.justifyContent = "space-between"
                        button.style.alignItems = "center"
                        button.style.margin = "21px 34px"
                        button.style.backgroundColor = "rgba(255, 255, 255, 0.6)"

                        button.style.borderRadius = "13px"
                        button.style.border = "0.3px solid black"
                        button.style.boxShadow = "0 3px 6px rgba(0, 0, 0, 0.16)"
                        button.style.cursor = "pointer"

                        button.addEventListener("click", async () => {

                          if (document.body.children.length > 0) {

                            Helper.popup(overlay => {

                              overlay.classList.add("overlay-3")
                              const overlay3 = overlay

                              Helper.headerPicker("removeOverlay", overlay)
                              const elementInfo = Helper.headerPicker("elementInfo", overlay)

                              elementInfo.append(Helper.convert("element/alias", document.body))

                              const span = document.createElement("span")
                              span.innerHTML = ".children"
                              span.style.fontSize = "13px"
                              span.style.fontFamily = "monospace"
                              elementInfo.append(span)

                              Helper.renderChildren(document.body, overlay)

                            })

                          } else alert("Das HTML Element ist leer.")


                        })

                        const left = document.createElement("div")
                        left.innerHTML = ".children"
                        left.style.margin = "21px 34px"
                        left.style.fontSize = "21px"
                        left.style.fontFamily = "sans-serif"
                        button.append(left)

                        const title = document.createElement("div")
                        title.innerHTML = "Element Inhalt"
                        title.style.margin = "21px 34px"
                        title.style.fontSize = "13px"
                        title.style.fontFamily = "sans-serif"
                        button.append(title)

                        buttons.append(button)
                      }

                      // add append html import string innerHTML??


                    })

                  })

                  const left = document.createElement("div")
                  left.innerHTML = "document.body"
                  left.style.margin = "21px 34px"
                  left.style.fontSize = "21px"
                  left.style.fontFamily = "sans-serif"
                  button.append(left)

                  const title = document.createElement("div")
                  title.innerHTML = "Dokumenteninhalt"
                  title.style.margin = "21px 34px"
                  title.style.fontSize = "13px"
                  title.style.fontFamily = "sans-serif"
                  button.append(title)

                  buttons.append(button)
                }

              })

            })

          }

        }

      }

    }
  }

</script>
