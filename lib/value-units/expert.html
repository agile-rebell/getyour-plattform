<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="/public/getyour-logo.svg" />
    <title>Getyour Experte</title>

    <style>
      body {
        margin: 0;
        line-height: 1.2;
        font-family: sans-serif;
        padding-bottom: 144px;
        overscroll-behavior: none;
      }
    </style>

  </head>
  <body>

    <script type="module">
      import { Request } from "/js/Request.js"
      import { Helper } from "/js/Helper.js"
      import { TextField } from "/js/TextField.js"
      import { TelField } from "/js/TelField.js"
      import { TextAreaField } from "/js/TextAreaField.js"
      import { FileField } from "/js/FileField.js"
      import { SelectionField } from "/js/SelectionField.js"
      import { RangeField } from "/js/RangeField.js"

      document.body.style.background = Helper.colors.light.background
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.style.background = Helper.colors.dark.background
      }

      Helper.headerPicker("back", document.body)

      {

        const header = Helper.headerPicker("app", document.body)

        header.addEventListener("click", () => {

          Helper.popup(async overlay => {
            Helper.headerPicker("removeOverlay", overlay)
            const info = Helper.headerPicker("info", overlay)
            info.append(document.location.pathname)

            const content = Helper.headerPicker("loading", overlay)

            const ping = {}
            ping.url = "/verify/expert/closed/"
            const res = await Request.location(ping)

            if (res.status === 200) {
              Helper.convert("parent/expert-closed", content)
            }

            if (res.status !== 200) {
              Helper.convert("parent/navigation-open", content)
            }

          })

        })

      }

      const title = Helper.render("text/title", "Plattformen", document.body)

      {
        const platformButtonsContainer = Helper.headerPicker("loading", document.body)

        if (window.localStorage.getItem("localStorageId") === null) {
          if (window.localStorage.getItem("email") === null) {

            const get = {}
            get.url = "/get/platforms/location/"
            const res = await Request.sequence(get)

            if (res.status !== 200) {

              Helper.convert("parent/info", platformButtonsContainer)

              platformButtonsContainer.innerHTML = `<span style="margin: 21px 34px;">Schon bald werden hier Plattformen für dich zur Verfügung stehen.</span>`
              throw new Error("platform not found")

            }

            if (res.status === 200) {
              const platforms = JSON.parse(res.response)

              if (platforms.length === 0) {

                Helper.convert("parent/info", platformButtonsContainer)

                platformButtonsContainer.innerHTML = `<span style="margin: 21px 34px;">Schon bald werden hier Plattformen für dich zur Verfügung stehen.</span>`
                throw new Error("platform not found")

              }

              Helper.convert("parent/scrollable", platformButtonsContainer)

              Helper.render("platforms/location", platforms, platformButtonsContainer)

            }

          }
        }

        if (window.localStorage.getItem("localStorageId") !== null) {
          if (window.localStorage.getItem("email") !== null) {

            {
              const verify = {}
              verify.url = "/verify/expert/closed/"
              const res = await Request.closed(verify)

              if (res.status !== 200) {

                const res = await Helper.get("platform-values/writability-closed")

                if (res.status === 200) {
                  const values = JSON.parse(res.response)

                  Helper.convert("parent/scrollable", platformButtonsContainer)
                  title.textContent = "Werteinheiten mit Schreibrechte"

                  for (let i = 0; i < values.length; i++) {
                    const value = values[i]


                    const button = Helper.create("button/left-right", platformButtonsContainer)
                    button.right.innerHTML = value.alias
                    button.left.innerHTML = value.path
                    button.onclick = () => window.location.assign(value.path)
                  }


                }

                if (res.status !== 200) {

                  const get = {}
                  get.url = "/get/platforms/location/"
                  const res = await Request.location(get)

                  if (res.status !== 200) {

                    Helper.convert("parent/info", platformButtonsContainer)

                    platformButtonsContainer.innerHTML = `<span style="margin: 21px 34px;">Schon bald werden hier Plattformen für dich zur Verfügung stehen.</span>`
                    throw new Error("platform not found")

                  }

                  if (res.status === 200) {
                    const platforms = JSON.parse(res.response)

                    if (platforms.length === 0) {

                      Helper.convert("parent/info", platformButtonsContainer)

                      platformButtonsContainer.innerHTML = `<span style="margin: 21px 34px;">Schon bald werden hier Plattformen für dich zur Verfügung stehen.</span>`
                      throw new Error("platform not found")

                    }

                    Helper.convert("parent/scrollable", platformButtonsContainer)

                    Helper.render("platforms/location", platforms, platformButtonsContainer)

                  }


                }


              }

              if (res.status === 200) {

                const get = {}
                get.url = "/get/platforms/closed/"
                const res = await Request.closed(get)

                if (res.status !== 200) {

                  Helper.convert("parent/info", platformButtonsContainer)

                  platformButtonsContainer.innerHTML = `<span style="margin: 21px 34px;">Schon bald werden hier Plattformen für dich zur Verfügung stehen.</span>`
                  throw new Error("platform not found")

                }

                if (res.status === 200) {
                  const platforms = JSON.parse(res.response)

                  if (platforms.length === 0) {

                    Helper.convert("parent/info", platformButtonsContainer)

                    platformButtonsContainer.innerHTML = `<span style="margin: 21px 34px;">Schon bald werden hier Plattformen für dich zur Verfügung stehen.</span>`
                    throw new Error("platform not found")

                  }

                  Helper.convert("parent/scrollable", platformButtonsContainer)
                  Helper.render("platforms/closed", platforms, platformButtonsContainer)
                }

              }

            }

          }
        }



      }

    </script>

  </body>
</html>
