<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="/public/getyour-logo.svg" />
    <title>Getyour Plattform Experte registrieren</title>

    <style>
      body {
        margin: 0;
        line-height: 1.2;
        font-family: sans-serif;
      }
    </style>
  </head>
  <body>

    <h1 class="title"></h1>

    <div class="info"></div>

    <div class="username"></div>
    <div class="email"></div>

    <div class="button"></div>

    <footer></footer>

    <script type="module">
      import { HeaderField } from "/js/HeaderField.js"
      import { InfoField } from "/js/InfoField.js"
      import { FooterField } from "/js/FooterField.js"
      import { TextField } from "/js/TextField.js"
      import { DivField } from "/js/DivField.js"
      import { Helper } from "/js/Helper.js"
      import { Request } from "/js/Request.js"
      import { EmailField } from "/js/EmailField.js"

      document.querySelectorAll(".title").forEach(title => {
        title.innerHTML = "Experte registrieren"
        title.style.margin = "34px"
        title.style.fontWeight = "normal"
      })

      const usernameField = new TextField("username")
      .withLabel(label => label.innerHTML = "Rufname:")
      .withType(input => {
        input.placeholder = "huansolo"
        input.pattern = "[a-z]{3,8}"
        input.required = true
      })
      .onInput(async() => {
        const username = await usernameField.withValidValue()
        document.querySelector("#url-preview").innerHTML = `https://get-your.de/<b>${username}</b>`
        usernameField.withValidValue()
      })
      usernameField.withValidValue()


      const emailField = new EmailField("email")
      .withLabel(label => label.innerHTML = "E-Mail Adresse:")
      .withType(email => {
        email.placeholder = "experte@email.de"
        email.required = true
      })
      .onInput(() => emailField.withValidValue())
      emailField.withValidValue()

      const infoField = new InfoField("info")
      .withWarning(/*html*/`
        <p>Der Pfad als Plattformentwickler beginnt immer mit einem Namen. Dieser Name wird in der URL f√ºr alle erreichbar sein. Aus dem Grund sind <b>mindestens 3</b> Kleinbuchstaben und <b>maximal 8</b> Kleinbuchstaben aus dem deutschen Alphabet erlaubt: <b>[a-z]</b></p>
        <ul>
          <li><b>[a-z]</b></li>
          <li><b>3 - 8 Kleinbuchstaben</b></li>
        </ul>
        <p id="url-preview">https://get-your.de/</p>
      `)
      .build()

      const loginbutton = new DivField("button")
      .withType(div => {
        div.innerHTML = "Jetzt registrieren"
        div.style.backgroundColor = "#c02221"
        div.style.cursor = "pointer"
        div.style.fontSize = "21px"
        div.style.borderRadius = "13px"
        div.style.margin = "13px 34px"
        div.style.display = "flex"
        div.style.justifyContent = "center"
        div.style.alignItems = "center"
        div.style.height = "89px"
        div.style.color = "white"
        div.addEventListener("mouseover", () => {
          div.style.backgroundColor = "#f19d08"
          div.style.color = "black"
        })
        div.addEventListener("mouseout", () => {
          div.style.color = "white"
          div.style.backgroundColor = "#c02221"
        })
      })
      .onClick(async (event) => {
        const username = await usernameField.withValidValue()
        const email = await emailField.withValidValue()

        const verifyName = {}
        verifyName.url = "/consumer/2/closed/"
        verifyName.method = "verify"
        verifyName.type = "name"
        verifyName.referer = document.referrer
        verifyName.localStorageId = await Request.localStorageId()
        verifyName.email = await Request.email()
        verifyName.nameToVerify = username
        const res = await Request.middleware(verifyName)

        if (res.status === 200) {
          alert("Dieser Rufname existiert bereits.")
          Helper.setNotValidStyle(document.querySelector(usernameField.inputSelector))
          return
        }

        await Request.withVerifiedEmail(await Request.email(), async () => {
          const inviteEmail = {}
          inviteEmail.url = "/invite/email/"
          inviteEmail.name = username
          inviteEmail.role = 3
          inviteEmail.referer = document.referrer
          inviteEmail.email = await Request.email()
          inviteEmail.localStorageId = await Request.localStorageId()
          inviteEmail.emailToInvite = email
          await Request.sequence(inviteEmail)


          alert("Einladung wurde verschickt..")
          window.location.assign("/getyour/pana/experte-registrieren/")
        })



      })

      const footerField = new FooterField()
      .withType(footer => {
        footer.style.backgroundColor = "#781717"
        footer.style.padding = "21px 34px"
        footer.style.marginTop = "144px"
        footer.style.color = "#d1d1d1"

        const impressum = document.createElement("div")
        impressum.innerHTML = "IMPRESSUM"
        impressum.style.cursor = "pointer"
        impressum.style.padding = "13px"
        impressum.addEventListener("click", () => window.location.assign("/impressum/"))
        footer.append(impressum)

        const dsgvo = document.createElement("div")
        dsgvo.innerHTML = "DATENSCHUTZ"
        dsgvo.style.cursor = "pointer"
        dsgvo.style.padding = "13px"
        dsgvo.addEventListener("click", () => window.location.assign("/datenschutz/"))
        footer.append(dsgvo)

        const userAgreement = document.createElement("div")
        userAgreement.innerHTML = "NUTZERVEREINBARUNG"
        userAgreement.style.cursor = "pointer"
        userAgreement.style.padding = "13px"
        userAgreement.addEventListener("click", () => window.location.assign("/nutzervereinbarung/"))
        footer.append(userAgreement)
      })


    </script>
</body>

</html>
