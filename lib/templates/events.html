<script id="dark-mode-style" alias="Skript passt das Design an, wenn der Nutzer Dark Mode in seinen Einstellungen ausgewählt hat">

  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {

    // append style in head and only if not exist
    // create dark mode styles for specific elements
  }


</script>

<script id="click-funnel-start-event" alias="Skript startet jeden Klick Funnel in deinem Dokument">
  import { Helper } from "/js/Helper.js"

  {
    document.querySelectorAll(".click-funnel").forEach(funnel => {

      const startButton = funnel.querySelector(".start-click-funnel-button")

      if (startButton.onclick === null) {
        startButton.onclick = () => {

          startButton.style.display = "none"

          const questions = []
          for (let i = 0; i < funnel.children.length; i++) {
            const child = funnel.children[i]
            if (child.classList.contains("click-field")) {
              questions.push(child)
              child.style.display = "flex"
              break
            }
          }

          if (questions.length <= 0) {
            Helper.request("end-click-funnel", funnel)
            return
          }
        }
      }

      for (let i = 0; i < funnel.children.length; i++) {
        const child = funnel.children[i]

        if (child.classList.contains("click-field")) {

          child.querySelectorAll(".answer-box").forEach(box => {

            if (box.onclick === null) {

              box.onclick = () => {

                child.style.display = "none"

                box.querySelectorAll(".answer").forEach(answer => {
                  answer.setAttribute("clicked", true)
                })

                if (child.nextSibling === null) {

                  Helper.request("end-click-funnel", funnel)

                  return

                }

                if (box.hasAttribute("onclick-condition")) {
                  const condition = JSON.parse(box.getAttribute("onclick-condition"))

                  if (condition.action === "skip") {
                    try {
                      Helper.skipSiblings(parseInt(condition.skip) + 1, child)

                      return
                    } catch (error) {

                      Helper.request("end-click-funnel", funnel)

                      return

                    }
                  }

                  if (condition.action === "path") {
                    window.location.assign(condition.path)
                    return
                  }

                }

                child.nextSibling.style.display = "flex"

              }

            }



          })

        }

      }

    })

  }



</script>


<script id="submit-field-funnel" alias="Startet ein Klick Event auf jeden Button mit der Id: submit-field-funnel-button">



  // submit button for field funnel



  // field addons müssen als bulk scripte
  // in templates angeboten werden
  // script muss immer wieder neu geladen werden

  // get funnel name on submit event


  // maybe do this in extra button script
  // submit fields button
  // need to check if the user is allowed to save to funnel
  // check in register if user has role of value unit or authorization
  // expert needs to register platform roles
  // expert needs to register user with role that he created

  // append button that
  // gets all fields
  // gets all ids
  // gets all selected answers by user
  // register user tags himself
  // with the platform from url
  // in that platform it saves the tag of the funnel
  // in that tag it saves all ids
  // in ids it saves the input/selected option


</script>
