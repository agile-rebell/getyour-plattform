<script id="funnel-create-popup-overlay-click-event-script" alias="Funnel erstellen - Popup Klick Event">

  import { Helper } from "/js/Helper.js"
  import { Request } from "/js/Request.js"
  import { TextField } from "/js/TextField.js"
  import { TelField } from "/js/TelField.js"
  import { SelectionField } from "/js/SelectionField.js"


  {

    const button = document.getElementById("quick-funnel-create-popup-button-outer-element")

    if (button !== null) {

      button.addEventListener("click", () => {

        Helper.popup(async overlay => {

          Helper.headerPicker("removeOverlay", overlay)
          const funnel = Helper.headerPicker("scrollable", overlay)


          const tagField = new TextField("tag", funnel)
          tagField.input.required = true
          tagField.label.innerHTML = "Speicherort"
          tagField.verifyValue()
          tagField.input.addEventListener("click", () => tagField.verifyValue())



        })

      })

    }

  }




</script>




<script id="quick-funnel-create-popup-button-outer-script" alias="Funnel erstellen - Popup Button">

  import { FunnelField } from "/js/FunnelField.js"
  import { Helper } from "/js/Helper.js"
  import { Request } from "/js/Request.js"


  // create funnel to create this list
  // create tag name field
  const button = Helper.buttonPicker("left/right")
  // id when creating
  button.id = "quick-funnel-create-popup-button-outer-element"
  button.left.innerHTML = ".create"
  button.right.innerHTML = "Funnel erstellen"
  if (document.getElementById("quick-funnel-create-popup-button-outer-element") === null) document.getElementById("quick-funnel-create-popup-button-outer-script").before(button)


  // const pathToAssets = "/felix/shs/public/"
  // const questions = [
  // { question: "Um ein individuelles Angebot erstellen zu können, schenken Sie uns bitte vorab 10 Minuten Ihrer wertvollen Zeit für die Beantwortung der Fragen. Damit wir herausfinden können, ob unser Konzept auch etwas für Sie ist und um Ihre Bedürfnisse noch besser verstehen zu können. <br/><br/>Einverstanden und bereit?", answers: [
  //   { answer: "JA! Ich bin bereit!", image: `${pathToAssets}ja.svg`},
  //   { answer: "Nein, das ist mir zu aufwendig.", image: `${pathToAssets}nein.svg`}
  // ]},
  // { question: "Wo möchten Sie die Photovoltaik installieren?", answers: [
  //   { answer: "Ein-Zweifamilienhaus", image: `${pathToAssets}einfamilienhaus.svg`},
  //   { answer: "Mehrfamilienhaus", image: `${pathToAssets}mehrfamilien.svg`},
  //   { answer: "Firmengebäude", image: `${pathToAssets}firmen.svg`},
  //   { answer: "Freilandfläche", image: `${pathToAssets}freiland.svg`},
  //   { answer: "Sonstiges", image: `${pathToAssets}sonstige.svg`}
  // ]},
  // { question: "Um welchen Gebäudetyp handelt es sich?", answers: [
  //   { answer: "freistehendes Haus", image: `${pathToAssets}freistehend.svg`},
  //   { answer: "Doppelhaushälfte", image: `${pathToAssets}doppelhaus.svg`},
  //   { answer: "Reihenhaus", image: `${pathToAssets}reihenhaus.svg`}
  // ]},
  // { question: "Bewohnen Sie die Immobilie selbst?", answers: [
  //   { answer: "Ja", image: `${pathToAssets}bewohnen.svg`},
  //   { answer: "Nein", image: `${pathToAssets}nichtbewohnen.svg`}
  // ]},
  // { question: "Sind Sie Eigentümer der Immobilie?", answers: [
  //   { answer: "Ja", image: `${pathToAssets}eigentuemer.svg`},
  //   { answer: "Nein", image: `${pathToAssets}nichteigentuemer.svg`}
  // ]},
  // { question: "Welche Dachform hat das Haus?", answers: [
  //   { answer: "Satteldach", image: `${pathToAssets}satteldach.svg`},
  //   { answer: "Pultdach", image: `${pathToAssets}pultdach.svg`},
  //   { answer: "Flachdach", image: `${pathToAssets}flachdach.svg`},
  //   { answer: "Walmdach", image: `${pathToAssets}walmdach.svg`},
  //   { answer: "Sonstiges", image: `${pathToAssets}sonstige.svg`}
  // ]},
  // { question: "Die Dacheindeckung ist..", answers: [
  //   { answer: "Steineindeckung", image: `${pathToAssets}steineindeckung.svg`},
  //   { answer: "Faserzement", image: `${pathToAssets}faserzement.svg`},
  //   { answer: "Blechdach", image: `${pathToAssets}blechdach.svg`},
  //   { answer: "Schiefer", image: `${pathToAssets}schiefer.svg`},
  //   { answer: "Dachpfannen", image: `${pathToAssets}dachpfannen.svg`},
  //   { answer: "Bieberschwanz", image: `${pathToAssets}bieberschwanz.svg`},
  //   { answer: "Sonstiges", image: `${pathToAssets}sonstige.svg`},
  // ]},
  // { question: "Möchten Sie Ihr Energiekonzept durch eine Photovoltaikanlage ergänzen?", answers: [
  //   { answer: "Ja", image: `${pathToAssets}photovoltaik.svg`},
  //   { answer: "Nein", image: `${pathToAssets}keinphotovoltaik.svg`}
  // ]},
  // { question: "Möchten Sie Ihr Energiekonzept durch einen Stromspeicher ergänzen?", answers: [
  //   { answer: "Ja", image: `${pathToAssets}speicher.svg`},
  //   { answer: "Nein", image: `${pathToAssets}keinspeicher.svg`}
  // ]},
  // { question: "Möchten Sie Ihr Energiekonzept durch einen Wärmepumpe ergänzen?", answers: [
  //   { answer: "Ja", image: `${pathToAssets}waermepumpe.svg`},
  //   { answer: "Nein", image: `${pathToAssets}keinewaermepumpe.svg`}
  // ]},
  // { question: "Möchten Sie Ihr Energiekonzept durch eine Solarthermie ergänzen?", answers: [
  //   { answer: "Ja", image: `${pathToAssets}solar.svg`},
  //   { answer: "Nein", image: `${pathToAssets}keinsolar.svg`}
  // ]},
  // { question: "Möchten Sie die Anlage mieten oder kaufen?", answers: [
  //   { answer: "Kaufen", image: `${pathToAssets}kaufen.svg`},
  //   { answer: "Mieten", image: `${pathToAssets}mieten.svg`}
  // ]},
  // { question: "Wollen Sie Bar bezahlen oder finanzieren?", answers: [
  //   { answer: "Bar bezahlen", image: `${pathToAssets}bar.svg`},
  //   { answer: "Ich möchte finanzieren", image: `${pathToAssets}finanzieren.svg`}
  // ]},
  // { question: "Wie alt sind Sie?", answers: [
  //   { answer: "20 - 40 Jahre", image: `${pathToAssets}20jahre.svg`},
  //   { answer: "41 - 50 Jahre", image: `${pathToAssets}41jahre.svg`},
  //   { answer: "51 - 70 Jahre", image: `${pathToAssets}51jahre.svg`},
  //   { answer: "über 70 Jahre", image: `${pathToAssets}ueber70.svg`},
  // ]},
  // { question: "Wann soll die Photovoltaik installiert werden?", answers: [
  //   { answer: "so schnell wie möglich", image: `${pathToAssets}sofort.svg`},
  //   { answer: "in 1-3 Monate", image: `${pathToAssets}ab1.svg`},
  //   { answer: "in 4-6 Monate", image: `${pathToAssets}ab4.svg`},
  //   { answer: "mehr als 6 Monate", image: `${pathToAssets}mehrals6.svg`},
  // ]},
  // ]

  // render list seperately with events
















  // const result = {}
  // const funnelField = new FunnelField(questions, document.body)
  // .withClickOnAnswerEventListener((questionIndex, answerIndex) => {


  //   result[`q${questionIndex}`] = answerIndex
  //   window.sessionStorage.setItem("funnel", JSON.stringify(result))

  //   if (questionIndex > questions.length - 1) {
  //     // after last question click
  //   }


  //   if (questionIndex === 0 && answerIndex === 1) {
  //     alert("Unter diesen Bedingungen können wir Ihnen leider kein Angebot machen.")
  //     window.location.assign("/felix/energie-plattform/")
  //     return
  //   }

  //   if (questionIndex === 1 && answerIndex === 1) {
  //     alert("Unter diesen Bedingungen können wir Ihnen leider kein Angebot machen.")
  //     window.location.assign("/felix/energie-plattform/")
  //     return
  //   }

  //   if (questionIndex === 1 && answerIndex === 3) {
  //     alert("Unter diesen Bedingungen können wir Ihnen leider kein Angebot machen.")
  //     window.location.assign("/felix/energie-plattform/")
  //     return
  //   }

  //   if (questionIndex === 10 && answerIndex === 1) {
  //     const funnel = JSON.parse(window.sessionStorage.getItem("funnel"))
  //     const q7 = funnel.q7
  //     const q8 = funnel.q8
  //     const q9 = funnel.q9
  //     if (q7 === 1 && q8 === 1 && q9 === 1) {
  //       alert("Unter diesen Bedingungen können wir Ihnen leider kein Angebot machen.")
  //       window.location.assign("/felix/energie-plattform/")
  //       return
  //     }
  //   }

  //   if (questionIndex === 11 && answerIndex === 1) {
  //     alert("Unter diesen Bedingungen können wir Ihnen leider kein Angebot machen.")
  //     window.location.assign("/felix/energie-plattform/")
  //     return
  //   }

  // })
  // .withFunnelCompleted(() => window.location.assign(`/felix/energie-plattform/abfrage-haus/1/`))



</script>






<script id="owner-funnel-button-outer-script" alias="Besitzerdaten abfragen - Button">
  import { Helper } from "/js/Helper.js"

  const button = Helper.buttonPicker("left/right")
  button.id = "owner-funnel-button-element"
  button.left.innerHTML = ".owner"
  button.right.innerHTML = "Besitzerdaten ändern"
  if (document.getElementById("owner-funnel-button-element") === null) document.getElementById("owner-funnel-button-outer-script").before(button)

</script>

<script id="owner-funnel-click-expert-event-script" alias="Besitzerdaten abfragen - Klick Event">

  import { Helper } from "/js/Helper.js"
  import { Request } from "/js/Request.js"
  import { TextField } from "/js/TextField.js"
  import { TelField } from "/js/TelField.js"
  import { SelectionField } from "/js/SelectionField.js"
  const button = document.getElementById("owner-funnel-button-element")

  if (button !== null) {

    button.addEventListener("click", () => {

      Helper.popup(async overlay => {

        Helper.headerPicker("removeOverlay", overlay)
        const funnel = Helper.headerPicker("loading", overlay)

        {
          const get = {}
          get.url = "/get/owner/closed/3/"
          get.type = "jwt"
          const res = await Request.middleware(get)

          Helper.convert("element/scrollable", funnel)

          const firstnameField = new TextField("firstname", funnel)
          firstnameField.value(name => window.localStorage.getItem(name))
          if (res.status === 200) {
            const owner = JSON.parse(res.response)
            if (owner.firstname !== undefined) {
              firstnameField.value(name => owner.firstname)
            }
          }
          firstnameField.label.innerHTML = "Vorname"
          firstnameField.input.placeholder = "Huan"
          firstnameField.input.required = true
          firstnameField.input.maxLength = "34"
          firstnameField.input.addEventListener("input", () => {
            const value = firstnameField.validValue()
            window.localStorage.setItem(firstnameField.name, value)
          })
          firstnameField.verifyValue()

          const lastnameField = new TextField("lastname", funnel)
          lastnameField.value(name => window.localStorage.getItem(name))
          if (res.status === 200) {
            const owner = JSON.parse(res.response)
            if (owner.lastname !== undefined) {
              lastnameField.value(name => owner.lastname)
            }
          }
          lastnameField.label.innerHTML = "Nachname"
          lastnameField.input.placeholder = "Solo"
          lastnameField.input.required = true
          lastnameField.input.maxLength = "34"
          lastnameField.input.addEventListener("input", () => {
            const value = lastnameField.validValue()
            window.localStorage.setItem(lastnameField.name, value)
          })
          lastnameField.verifyValue()

          const streetField = new TextField("street", funnel)
          streetField.value(name => window.localStorage.getItem(name))
          if (res.status === 200) {
            const owner = JSON.parse(res.response)
            if (owner.street !== undefined) {
              streetField.value(name => owner.street)
            }
          }
          streetField.label.innerHTML = "Straße und Hausnummer"
          streetField.input.required = true
          streetField.input.placeholder = "Wiesentalstr. 21"
          streetField.input.maxLength = "34"
          streetField.input.addEventListener("input", () => {
            const value = streetField.validValue()
            window.localStorage.setItem(streetField.name, value)
          })
          streetField.verifyValue()

          const zipField = new TextField("zip", funnel)
          zipField.value(name => window.localStorage.getItem(name))
          if (res.status === 200) {
            const owner = JSON.parse(res.response)
            if (owner.zip !== undefined) {
              zipField.value(name => owner.zip)
            }
          }
          zipField.label.innerHTML = "Postleitzahl und Ort"
          zipField.input.placeholder = "70184 Stuttgart"
          zipField.input.required = true
          zipField.input.maxLength = "34"
          zipField.input.addEventListener("input", () => {
            const value = zipField.validValue()
            window.localStorage.setItem(zipField.name, value)
          })
          zipField.verifyValue()

          const stateField = new SelectionField("state", funnel)
          stateField.value(name => [window.localStorage.getItem(name)])
          if (res.status === 200) {
            const owner = JSON.parse(res.response)
            if (owner.state !== undefined) {
              stateField.value(name => [owner.state])
            }
          }
          stateField.label.innerHTML = "Bundesland oder Kanton"
          stateField.withOptionSelected(option => window.localStorage.setItem(stateField.name, option.value))
          stateField.verifyValue()

          const countryField = new SelectionField("country", funnel)
          countryField.value(name => [window.localStorage.getItem(name)])
          if (res.status === 200) {
            const owner = JSON.parse(res.response)
            if (owner.country !== undefined) {
              countryField.value(name => [owner.country])
            }
          }
          countryField.label.innerHTML = "Land"
          countryField.options(["Deutschland", "Österreich", "Schweiz"])
          countryField.select.addEventListener("input", (event) => {
            countryField.withOptionSelected(option => {
              stateField.addStatesByCountry(option.value)
              window.localStorage.setItem(countryField.name, option.value)
            })
          })
          countryField.withOptionSelected(option => {
            stateField.addStatesByCountry(option.value)
            window.localStorage.setItem(countryField.name, option.value)
          })
          countryField.verifyValue()

          const phoneField = new TelField("phone", funnel)
          phoneField.value(name => window.localStorage.getItem(name))
          if (res.status === 200) {
            const owner = JSON.parse(res.response)
            if (owner.phone !== undefined) {
              phoneField.value(name => owner.phone)
            }
          }
          phoneField.label.innerHTML = "Telefon"
          phoneField.input.required = true
          phoneField.input.maxLength = "21"
          phoneField.input.accept = "text/phone"
          phoneField.input.placeholder = "+49.."
          phoneField.input.addEventListener("input", () => {
            const value = phoneField.validValue()
            window.localStorage.setItem(phoneField.name, value)
          })
          phoneField.verifyValue()

          const submitButton = document.createElement("div")
          submitButton.innerHTML = "Speichern"
          submitButton.style.fontSize = "21px"
          submitButton.style.margin = "21px 34px"
          submitButton.style.backgroundColor = "#f7aa20"
          submitButton.style.borderRadius = "13px"
          submitButton.style.height = "89px"
          submitButton.style.display = "flex"
          submitButton.style.justifyContent = "center"
          submitButton.style.alignItems = "center"
          submitButton.style.boxShadow = "0 3px 6px rgba(0, 0, 0, 0.16)"
          submitButton.style.cursor = "pointer"
          submitButton.addEventListener("click", async () => {

            let firstname
            let lastname
            let street
            let zip
            let state
            let country
            let phone
            try {
              firstname = firstnameField.validValue()
              lastname = lastnameField.validValue()
              street = streetField.validValue()
              zip = zipField.validValue()
              state = stateField.validValue()[0].value
              country = countryField.validValue()[0].value
              phone = phoneField.validValue()
            } catch (error) {
              alert(error.message)
              error.field.scrollIntoView({behavior: 'smooth'})
              throw error
            }


            Helper.addOverlay()
            Helper.setWaitCursor()
            try {

              const register = {}
              register.url = "/register/owner/closed/3/"
              register.firstname = firstname
              register.lastname = lastname
              register.street = street
              register.zip = zip
              register.country = country
              register.state = state
              register.phone = phone
              register.location = window.location.href
              register.referer = document.referrer
              register.localStorageEmail = await Request.email()
              register.localStorageId = await Request.localStorageId()
              await Request.sequence(register)

              alert("Speichern erfolgreich..")
            } catch (error) {
              alert("Fehler.. Bitte wiederholen.")
            }
            window.location.reload()
          })
          funnel.append(submitButton)
        }



      })

    })

  }

</script>
